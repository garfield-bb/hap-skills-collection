# HAP V3 API ä½¿ç”¨è§„èŒƒå®Œæ•´æŒ‡å—

> æœ¬æ–‡æ¡£æ€»ç»“äº†HAP V3 APIçš„æ ¸å¿ƒä½¿ç”¨è§„èŒƒã€æœ€ä½³å®è·µå’Œå¸¸è§é™·é˜±,åŸºäºå®é™…æµ‹è¯•éªŒè¯

## ğŸ“š å¦‚ä½•è·å–æœ€æ–°çš„ API V3 æ–‡æ¡£

åœ¨å¼€å§‹ä½¿ç”¨ HAP API V3 ä¹‹å‰,å»ºè®®å…ˆé€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–æœ€æ–°çš„ API æ–‡æ¡£:

### æ–¹å¼ä¸€: ä½¿ç”¨åº”ç”¨ API MCP æœåŠ¡å™¨ (æ¨è)

é€šè¿‡ MCP æœåŠ¡å™¨ç›´æ¥è®¿é—®æœ€æ–°çš„ API V3 æ–‡æ¡£ç»“æ„ã€‚å½“ä½ çœ‹åˆ°ä»¥ä¸‹ JSON ä»£è¡¨æ˜¯ å®˜æ–¹APIæ–‡æ¡£çš„ MCPé…ç½®


**é…ç½®æ–¹æ³•**:

```json
{
  "mcpServers": {
    "åº”ç”¨ API - API æ–‡æ¡£": {
      "command": "npx",
      "args": [
        "-y",
        "apifox-mcp-server@latest",
        "--site-id=5442569"
      ]
    }
  }
}
```

**ğŸ’¡ å…³äºå…¶ä»– MCP é…ç½®**: å¦‚éœ€é…ç½® HAP åº”ç”¨ MCP (ç”¨äºæ“ä½œ HAP æ•°æ®),è¯·å‚è€ƒ [HAP MCP ä½¿ç”¨æŒ‡å—](HAP_MCP_Guide.md)

---

### æ–¹å¼äºŒ: è®¿é—®åœ¨çº¿æ–‡æ¡£

å¦‚æœæ— æ³•é€šè¿‡ MCPè®¿é—®åˆ°åº”ç”¨ APIæ–‡æ¡£,å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ¨çº¿åœ°å€ç›´æ¥è®¿é—® API V3 æ–‡æ¡£:

**æ¦‚è¿°æ–‡æ¡£**:
- [API æ•´ä½“ä»‹ç»](https://apifox.mingdao.com/7271706m0.md)
- [å­—æ®µç±»å‹å¯¹ç…§è¡¨](https://apifox.mingdao.com/7271709m0.md)
- [ç­›é€‰å™¨ä½¿ç”¨æŒ‡å—](https://apifox.mingdao.com/7271713m0.md)
- [é”™è¯¯ç è¯´æ˜](https://apifox.mingdao.com/7271715m0.md)

**API ç«¯ç‚¹æ–‡æ¡£**: å®Œæ•´çš„ API ç«¯ç‚¹åˆ—è¡¨è§æ–‡æ¡£åé¢çš„"åœ¨çº¿æ–‡æ¡£èµ„æº"ç« èŠ‚ã€‚

---

## åœ¨çº¿æ–‡æ¡£èµ„æº

ä¼˜å…ˆä½¿ç”¨ MCP æœåŠ¡å™¨è®¿é—®æœ€æ–°çš„ API æ–‡æ¡£ç»“æ„ã€‚å¦‚æœ MCP ä¸å¯ç”¨,å¯ä»¥é€šè¿‡ä»¥ä¸‹å®˜æ–¹åœ¨çº¿æ–‡æ¡£è·å–ã€‚

### åº”ç”¨ API V3 æ–‡æ¡£

#### æ¦‚è¿°æ–‡æ¡£
- [V3-beta (AI å‹å¥½) æ¦‚è¿°](https://apifox.mingdao.com/7271706m0.md) - API æ•´ä½“ä»‹ç»å’Œä½¿ç”¨è¯´æ˜
- [V3-beta (AI å‹å¥½) å­—æ®µç±»å‹å¯¹ç…§è¡¨](https://apifox.mingdao.com/7271709m0.md) - å®Œæ•´çš„å­—æ®µç±»å‹è¯´æ˜
- [V3-beta (AI å‹å¥½) ç­›é€‰å™¨ä½¿ç”¨æŒ‡å—](https://apifox.mingdao.com/7271713m0.md) - Filter å¯¹è±¡è¯¦ç»†è¯´æ˜
- [V3-beta (AI å‹å¥½) é”™è¯¯ç ](https://apifox.mingdao.com/7271715m0.md) - API é”™è¯¯ç è¯´æ˜

#### åº”ç”¨ API ç«¯ç‚¹æ–‡æ¡£
- **åº”ç”¨**: [è·å–åº”ç”¨ä¿¡æ¯](https://apifox.mingdao.com/339496583e0.md)
- **å·¥ä½œè¡¨**:
  - [è·å–å·¥ä½œè¡¨åˆ—è¡¨](https://apifox.mingdao.com/359328827e0.md)
  - [è·å–å·¥ä½œè¡¨ç»“æ„ä¿¡æ¯](https://apifox.mingdao.com/339496584e0.md)
  - [ç¼–è¾‘å·¥ä½œè¡¨](https://apifox.mingdao.com/339496585e0.md)
  - [åˆ é™¤å·¥ä½œè¡¨](https://apifox.mingdao.com/339496586e0.md)
  - [æ–°å»ºå·¥ä½œè¡¨](https://apifox.mingdao.com/339496587e0.md)
- **å·¥ä½œè¡¨è¡Œè®°å½•**:
  - [è·å–è¡Œè®°å½•åˆ—è¡¨](https://apifox.mingdao.com/339496588e0.md)
  - [è·å–è¡Œè®°å½•è¯¦æƒ…](https://apifox.mingdao.com/339496589e0.md)
  - [æ–°å»ºè¡Œè®°å½•](https://apifox.mingdao.com/339496593e0.md)
  - [æ›´æ–°è¡Œè®°å½•](https://apifox.mingdao.com/339496590e0.md)
  - [åˆ é™¤è¡Œè®°å½•](https://apifox.mingdao.com/339496591e0.md)
  - [æ‰¹é‡æ–°å¢è¡Œè®°å½•](https://apifox.mingdao.com/339496594e0.md)
  - [æ‰¹é‡æ›´æ–°è¡Œè®°å½•](https://apifox.mingdao.com/339496595e0.md)
  - [æ‰¹é‡åˆ é™¤è¡Œè®°å½•](https://apifox.mingdao.com/339496596e0.md)
  - [è·å–å…³è”è®°å½•](https://apifox.mingdao.com/339496592e0.md)
  - [è·å–è¡Œè®°å½•é€è§†æ•°æ®](https://apifox.mingdao.com/339496597e0.md)
  - [è·å–è®°å½•åˆ†äº«é“¾æ¥](https://apifox.mingdao.com/339496598e0.md)
  - [è·å–è¡Œè®°å½•æ—¥å¿—](https://apifox.mingdao.com/339496599e0.md)
  - [è·å–è¡Œè®°å½•è®¨è®º](https://apifox.mingdao.com/339496600e0.md)
- **é€‰é¡¹é›†**:
  - [è·å–é€‰é¡¹é›†åˆ—è¡¨](https://apifox.mingdao.com/339496601e0.md)
  - [åˆ›å»ºé€‰é¡¹é›†](https://apifox.mingdao.com/339496602e0.md)
  - [ç¼–è¾‘é€‰é¡¹é›†](https://apifox.mingdao.com/339496603e0.md)
  - [åœç”¨é€‰é¡¹é›†](https://apifox.mingdao.com/339496604e0.md)
- **å·¥ä½œæµ**:
  - [è·å–æµç¨‹åˆ—è¡¨](https://apifox.mingdao.com/339496605e0.md)
  - [è·å–æµç¨‹è¯¦æƒ…](https://apifox.mingdao.com/339496606e0.md)
  - [è§¦å‘æµç¨‹](https://apifox.mingdao.com/339496607e0.md)
- **è§’è‰²**:
  - [è·å–è§’è‰²åˆ—è¡¨](https://apifox.mingdao.com/339496608e0.md)
  - [åˆ›å»ºè§’è‰²](https://apifox.mingdao.com/339496609e0.md)
  - [è·å–è§’è‰²è¯¦æƒ…](https://apifox.mingdao.com/339496610e0.md)
  - [åˆ é™¤è§’è‰²](https://apifox.mingdao.com/339496611e0.md)
  - [æ·»åŠ è§’è‰²æˆå‘˜](https://apifox.mingdao.com/339496612e0.md)
  - [ç§»é™¤è§’è‰²æˆå‘˜](https://apifox.mingdao.com/339496613e0.md)
  - [æˆå‘˜é€€å‡ºæ‰€æœ‰è§’è‰²](https://apifox.mingdao.com/339496614e0.md)
- **å…¬å…±æŸ¥è¯¢**:
  - [æŸ¥æ‰¾æˆå‘˜](https://apifox.mingdao.com/339496615e0.md)
  - [æŸ¥æ‰¾éƒ¨é—¨](https://apifox.mingdao.com/339496616e0.md)
  - [è·å–åœ°åŒºä¿¡æ¯](https://apifox.mingdao.com/339496617e0.md)

### ä½¿ç”¨å»ºè®®

1. **ä¼˜å…ˆä½¿ç”¨ MCP**: é€šè¿‡é…ç½®å¥½çš„ MCP æœåŠ¡å™¨å¯ä»¥ç›´æ¥åœ¨ Claude Code ä¸­è®¿é—®æœ€æ–°çš„ API ç»“æ„,æ— éœ€æ‰‹åŠ¨æŸ¥é˜…æ–‡æ¡£
2. **åœ¨çº¿æ–‡æ¡£ä½œä¸ºè¡¥å……**: å½“éœ€è¦è¯¦ç»†è¯´æ˜æˆ–ç¤ºä¾‹æ—¶,å¯ä»¥è®¿é—®ä¸Šè¿°åœ¨çº¿æ–‡æ¡£
3. **å…³æ³¨å­—æ®µç±»å‹**: å­—æ®µç±»å‹å¯¹ç…§è¡¨å’Œç­›é€‰å™¨ä½¿ç”¨æŒ‡å—æ˜¯æœ€å¸¸ç”¨çš„å‚è€ƒæ–‡æ¡£
4. **é”™è¯¯æ’æŸ¥**: é‡åˆ° API è°ƒç”¨é—®é¢˜æ—¶,å…ˆæŸ¥çœ‹é”™è¯¯ç æ–‡æ¡£

---

## ç›®å½•

0. [å¿«é€Ÿå¼€å§‹ - API ä½¿ç”¨æµç¨‹](#é›¶å¿«é€Ÿå¼€å§‹---api-ä½¿ç”¨æµç¨‹)
1. [åˆ›å»ºå·¥ä½œè¡¨è§„èŒƒ](#ä¸€åˆ›å»ºå·¥ä½œè¡¨è§„èŒƒ)
2. [å­—æ®µç±»å‹å‚æ•°è¯¦è§£](#äºŒå­—æ®µç±»å‹å‚æ•°è¯¦è§£)
3. [åˆ›å»º/æ›´æ–°è®°å½•è§„èŒƒ](#ä¸‰åˆ›å»ºæ›´æ–°è®°å½•è§„èŒƒ)
4. [æŸ¥è¯¢ç­›é€‰è§„èŒƒ](#å››æŸ¥è¯¢ç­›é€‰è§„èŒƒ)
5. [æ•°æ®é€è§†åˆ†æè§„èŒƒ](#äº”æ•°æ®é€è§†åˆ†æè§„èŒƒ)
6. [å…³è”å­—æ®µå®Œæ•´æŒ‡å—](#å…­å…³è”å­—æ®µå®Œæ•´æŒ‡å—)
7. [å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ](#ä¸ƒå¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ)

---

## é›¶ã€å¿«é€Ÿå¼€å§‹ - API ä½¿ç”¨æµç¨‹

### 0.1 HAP V3 API æ•´ä½“æ¶æ„

```
æ˜é“äº‘ç»„ç»‡
  â””â”€â”€ åº”ç”¨ (Application)
       â”œâ”€â”€ è§’è‰² (Role)
       â”œâ”€â”€ å·¥ä½œæµ (Workflow)
       â”œâ”€â”€ å·¥ä½œè¡¨åˆ†ç»„ (Section)
       â””â”€â”€ å·¥ä½œè¡¨ (Worksheet)
            â”œâ”€â”€ å­—æ®µ (Field/Control)
            â”œâ”€â”€ è§†å›¾ (View)
            â””â”€â”€ è®°å½• (Row/Record)
```

---

### 0.2 ä»é›¶æ­å»ºåº”ç”¨çš„å®Œæ•´æµç¨‹

#### **é˜¶æ®µä¸€: å‡†å¤‡å·¥ä½œ**

**Step 1: è·å– API å‡­è¯**

1. ç™»å½•æ˜é“äº‘ç®¡ç†åå°
2. è¿›å…¥ã€ŒAPI ç®¡ç†ã€
3. è·å–ä»¥ä¸‹ä¿¡æ¯:
   - **AppKey**: åº”ç”¨æ ‡è¯†
   - **Sign**: ç­¾åå¯†é’¥
   - **åº”ç”¨ ID (app_id)**: ç›®æ ‡åº”ç”¨çš„ID

**Step 2: é…ç½® API è¯·æ±‚å¤´**

æ‰€æœ‰ HAP V3 API è¯·æ±‚éƒ½éœ€è¦ä»¥ä¸‹è¯·æ±‚å¤´:

```javascript
const headers = {
  'Content-Type': 'application/json',
  'AppKey': 'your-app-key',
  'Sign': 'your-sign-key'
};
```

---

#### **é˜¶æ®µäºŒ: åˆ›å»ºåº”ç”¨ç»“æ„**

**Step 3: è·å–åº”ç”¨ä¿¡æ¯(å¯é€‰)**

æŸ¥çœ‹åº”ç”¨ç°æœ‰ç»“æ„:

```bash
GET /v3/app/info
```

è¿”å›åº”ç”¨çš„åˆ†ç»„ã€å·¥ä½œè¡¨ã€è‡ªå®šä¹‰é¡µé¢ç­‰ä¿¡æ¯ã€‚

---

**Step 4: åˆ›å»ºå·¥ä½œè¡¨**

```javascript
// ç¤ºä¾‹: åˆ›å»ºå®¢æˆ·ä¿¡æ¯è¡¨
POST /v3/app/worksheets
{
  "name": "å®¢æˆ·ä¿¡æ¯è¡¨",
  "alias": "customers",
  "fields": [
    {
      "name": "å®¢æˆ·åç§°",
      "alias": "customer_name",
      "type": "Text",
      "isTitle": true,
      "required": true
    },
    {
      "name": "å®¢æˆ·ç±»å‹",
      "alias": "customer_type",
      "type": "SingleSelect",
      "options": [
        {"value": "æ½œåœ¨å®¢æˆ·", "index": 1},
        {"value": "æ„å‘å®¢æˆ·", "index": 2},
        {"value": "æˆäº¤å®¢æˆ·", "index": 3}
      ]
    },
    {
      "name": "å¹´åº¦é¢„ç®—",
      "alias": "annual_budget",
      "type": "Number",
      "precision": 2
    }
  ]
}

// è¿”å›: { "worksheet_id": "696367c3b86aebd924a164f0" }
```

**å…³é”®ç‚¹**:
- âœ… ä¸€æ¬¡æ€§å®šä¹‰æ‰€æœ‰åŸºç¡€å­—æ®µ
- âœ… ä½¿ç”¨ `alias` ä¾¿äºåç»­å¼•ç”¨
- âœ… è‡³å°‘è¦æœ‰ä¸€ä¸ªå­—æ®µè®¾ç½® `isTitle: true`

---

**Step 5: æ·»åŠ å…³è”å­—æ®µ(å¦‚éœ€è¦)**

å¦‚æœéœ€è¦å…³è”å…¶ä»–å·¥ä½œè¡¨:

```javascript
// å…ˆåˆ›å»ºç›®æ ‡è¡¨(å¦‚ä¸Šä¸€æ­¥)
// ç„¶ååˆ›å»ºå…³è”å­—æ®µ

POST /v3/app/worksheets/{worksheet_id}
{
  "addFields": [
    {
      "name": "å…³è”å®¢æˆ·",
      "alias": "related_customer",
      "type": "Relation",
      "subType": "1",  // å•æ¡å…³è”
      "dataSource": "696367c3b86aebd924a164f0",  // å®¢æˆ·è¡¨ID
      "relation": {
        "bidirectional": false,
        "showFields": ["customer_name", "customer_type"]
      }
    }
  ]
}
```

---

#### **é˜¶æ®µä¸‰: å¡«å……æ•°æ®**

**Step 6: å‡†å¤‡é€‰é¡¹å­—æ®µæ˜ å°„**

å¯¹äºå•é€‰/å¤šé€‰å­—æ®µ,éœ€è¦å…ˆè·å–é€‰é¡¹çš„ key:

```javascript
// æ–¹æ³•1: æŸ¥è¯¢å·¥ä½œè¡¨ç»“æ„
GET /v3/app/worksheets/{worksheet_id}

// ä»è¿”å›çš„ fields ä¸­æ‰¾åˆ° options:
{
  "fields": [
    {
      "id": "customer_type",
      "type": "SingleSelect",
      "options": [
        {"key": "74c7b607-864d-4cc4-b401-28acba2636e9", "value": "æˆäº¤å®¢æˆ·"},
        {"key": "f488d4db-5046-4b10-978f-7869c4c70a71", "value": "æ„å‘å®¢æˆ·"}
      ]
    }
  ]
}

// å»ºç«‹æ˜ å°„è¡¨
const optionMap = {
  "æˆäº¤å®¢æˆ·": "74c7b607-864d-4cc4-b401-28acba2636e9",
  "æ„å‘å®¢æˆ·": "f488d4db-5046-4b10-978f-7869c4c70a71"
};
```

---

**Step 7: åˆ›å»ºè®°å½•**

```javascript
POST /v3/app/worksheets/{worksheet_id}/rows
{
  "fields": [
    {
      "id": "customer_name",
      "value": "æ˜é“äº‘ç§‘æŠ€æœ‰é™å…¬å¸"
    },
    {
      "id": "customer_type",
      "value": ["74c7b607-864d-4cc4-b401-28acba2636e9"]  // ä½¿ç”¨é€‰é¡¹key
    },
    {
      "id": "annual_budget",
      "value": 1000000.50
    }
  ],
  "triggerWorkflow": true  // æ˜¯å¦è§¦å‘å·¥ä½œæµ
}

// è¿”å›: { "row_id": "c74a29f0-f694-4501-9ba0-936e259daa9d" }
```

**å…³é”®ç‚¹**:
- âš ï¸ é€‰é¡¹å­—æ®µå¿…é¡»ç”¨ key,ä¸èƒ½ç”¨æ˜¾ç¤ºæ–‡æœ¬
- âš ï¸ é€‰é¡¹å­—æ®µå³ä½¿å•é€‰ä¹Ÿè¦ç”¨æ•°ç»„æ ¼å¼
- âœ… æ•°å€¼å­—æ®µå†™å…¥æ—¶ä¼ æ•°å­—,è¯»å–æ—¶è¿”å›å­—ç¬¦ä¸²

---

**Step 8: æ‰¹é‡åˆ›å»ºè®°å½•(å¯é€‰)**

```javascript
POST /v3/app/worksheets/{worksheet_id}/rows/batch
{
  "rows": [
    {
      "fields": [
        {"id": "customer_name", "value": "å®¢æˆ·A"},
        {"id": "customer_type", "value": ["key1"]}
      ]
    },
    {
      "fields": [
        {"id": "customer_name", "value": "å®¢æˆ·B"},
        {"id": "customer_type", "value": ["key2"]}
      ]
    }
  ],
  "triggerWorkflow": true
}
```

**å»ºè®®**: ä¸€æ¬¡æ‰¹é‡åˆ›å»ºä¸è¶…è¿‡ 100 æ¡è®°å½•

---

#### **é˜¶æ®µå››: æŸ¥è¯¢å’Œåˆ†ææ•°æ®**

**Step 9: æŸ¥è¯¢è®°å½•åˆ—è¡¨**

```javascript
POST /v3/app/worksheets/{worksheet_id}/rows/list
{
  "filter": {
    "type": "group",
    "logic": "AND",
    "children": [
      {
        "type": "condition",
        "field": "customer_type",
        "operator": "eq",
        "value": ["74c7b607-864d-4cc4-b401-28acba2636e9"]  // æˆäº¤å®¢æˆ·
      },
      {
        "type": "condition",
        "field": "annual_budget",
        "operator": "gte",
        "value": ["500000"]  // é¢„ç®—>=50ä¸‡
      }
    ]
  },
  "sorts": [
    {
      "field": "annual_budget",
      "isAsc": false  // é™åº
    }
  ],
  "pageIndex": 1,
  "pageSize": 20
}
```

---

**Step 10: æ•°æ®é€è§†åˆ†æ**

```javascript
POST /v3/app/worksheets/{worksheet_id}/rows/pivot
{
  "rows": [
    {
      "field": "customer_type",
      "displayName": "å®¢æˆ·ç±»å‹"
    }
  ],
  "values": [
    {
      "field": "rowid",
      "aggregation": "COUNT",
      "displayName": "å®¢æˆ·æ•°é‡"
    },
    {
      "field": "annual_budget",
      "aggregation": "SUM",
      "displayName": "é¢„ç®—æ€»é¢"
    }
  ],
  "includeSummary": true
}
```

---

#### **é˜¶æ®µäº”: æ›´æ–°å’Œç»´æŠ¤æ•°æ®**

**Step 11: æ›´æ–°è®°å½•**

```javascript
POST /v3/app/worksheets/{worksheet_id}/rows/{row_id}
{
  "fields": [
    {
      "id": "customer_type",
      "value": ["new-option-key"]  // æ›´æ”¹å®¢æˆ·ç±»å‹
    },
    {
      "id": "annual_budget",
      "value": 1500000  // æ›´æ–°é¢„ç®—
    }
  ],
  "triggerWorkflow": true
}
```

---

**Step 12: åˆ é™¤è®°å½•**

```javascript
// å•æ¡åˆ é™¤
DELETE /v3/app/worksheets/{worksheet_id}/rows/{row_id}
{
  "permanent": false,  // false=é€»è¾‘åˆ é™¤(å¯æ¢å¤), true=æ°¸ä¹…åˆ é™¤
  "triggerWorkflow": true
}

// æ‰¹é‡åˆ é™¤
DELETE /v3/app/worksheets/{worksheet_id}/rows/batch
{
  "rowIds": ["row-id-1", "row-id-2"],
  "permanent": false,
  "triggerWorkflow": true
}
```

âš ï¸ **è­¦å‘Š**: `permanent: true` ä¼šæ°¸ä¹…åˆ é™¤æ•°æ®,æ— æ³•æ¢å¤!

---

### 0.3 API è°ƒç”¨æœ€ä½³å®è·µ

#### **åˆå§‹åŒ–é˜¶æ®µçš„å»ºè®®æ­¥éª¤**

```javascript
// 1. è·å–åº”ç”¨ç»“æ„
const appInfo = await getAppInfo();

// 2. è·å–æ‰€æœ‰å·¥ä½œè¡¨ç»“æ„
const worksheets = {};
for (const ws of appInfo.worksheets) {
  worksheets[ws.alias] = await getWorksheetStructure(ws.worksheet_id);
}

// 3. å»ºç«‹é€‰é¡¹å­—æ®µæ˜ å°„
const optionMaps = {};
for (const [alias, structure] of Object.entries(worksheets)) {
  optionMaps[alias] = {};
  structure.fields.forEach(field => {
    if (field.type === 'SingleSelect' || field.type === 'MultipleSelect') {
      optionMaps[alias][field.alias] = {};
      field.options.forEach(opt => {
        optionMaps[alias][field.alias][opt.value] = opt.key;
      });
    }
  });
}

// 4. ç¼“å­˜å­—æ®µIDæ˜ å°„
const fieldMaps = {};
for (const [alias, structure] of Object.entries(worksheets)) {
  fieldMaps[alias] = {};
  structure.fields.forEach(field => {
    fieldMaps[alias][field.alias] = field.id;
  });
}
```

---

#### **è¿è¡Œæ—¶çš„å»ºè®®**

1. **ä½¿ç”¨å­—æ®µIDè€Œä¸æ˜¯åˆ«å**: æ€§èƒ½æ›´å¥½
2. **ç¼“å­˜é€‰é¡¹æ˜ å°„**: é¿å…é‡å¤æŸ¥è¯¢
3. **åˆç†ä½¿ç”¨åˆ†é¡µ**: pageSize å»ºè®® 100-500
4. **æ‰¹é‡æ“ä½œåˆ†æ‰¹**: æ¯æ‰¹ä¸è¶…è¿‡ 100 æ¡
5. **å¼‚æ­¥å¤„ç†é™„ä»¶**: ä¸Šä¼ åç­‰å¾… 5-10 ç§’

---

### 0.4 å¸¸è§åœºæ™¯å¿«é€Ÿå‚è€ƒ

| åœºæ™¯ | API ç«¯ç‚¹ | å…³é”®å‚æ•° |
|-----|---------|---------|
| åˆ›å»ºå·¥ä½œè¡¨ | `POST /v3/app/worksheets` | fields |
| æ·»åŠ å­—æ®µ | `POST /v3/app/worksheets/{id}` | addFields |
| åˆ›å»ºè®°å½• | `POST /v3/app/worksheets/{id}/rows` | fields |
| æ‰¹é‡åˆ›å»º | `POST /v3/app/worksheets/{id}/rows/batch` | rows |
| æŸ¥è¯¢è®°å½• | `POST /v3/app/worksheets/{id}/rows/list` | filter, sorts |
| æ›´æ–°è®°å½• | `POST /v3/app/worksheets/{id}/rows/{row_id}` | fields |
| æ‰¹é‡æ›´æ–° | `PUT /v3/app/worksheets/{id}/rows/batch` | rowIds, fields |
| åˆ é™¤è®°å½• | `DELETE /v3/app/worksheets/{id}/rows/{row_id}` | permanent |
| æ‰¹é‡åˆ é™¤ | `DELETE /v3/app/worksheets/{id}/rows/batch` | rowIds, permanent |
| é€è§†åˆ†æ | `POST /v3/app/worksheets/{id}/rows/pivot` | rows, values |
| æŸ¥æ‰¾ç”¨æˆ· | `POST /v3/users/lookup` | name |
| æŸ¥æ‰¾éƒ¨é—¨ | `POST /v3/departments/lookup` | name |

---

### 0.5 å…³é”®æ¦‚å¿µé€ŸæŸ¥

**å­—æ®µç±»å‹ (type)**:
- åŸºç¡€: `Text`, `Number`, `Date`, `Time`
- é€‰æ‹©: `SingleSelect`, `MultipleSelect`
- å…³ç³»: `Relation`, `Collaborator`, `Department`
- å…¶ä»–: `Attachment`, `Rating`

**ç­›é€‰æ“ä½œç¬¦ (operator)**:
- æ¯”è¾ƒ: `eq`, `ne`, `gt`, `gte`, `lt`, `lte`
- æ–‡æœ¬: `contains`, `startswith`, `endswith`
- èŒƒå›´: `between`, `in`
- å…³è”: `belongsto`
- ç©ºå€¼: `isempty`, `isnotempty`

**subType å‚æ•°**:
- Collaborator: `0`=å•é€‰, `1`=å¤šé€‰
- Relation: `1`=å•æ¡, `2`=å¤šæ¡
- Time: `1`=æ—¶:åˆ†, `6`=æ—¶:åˆ†:ç§’
- Date: `3`=å¹´æœˆæ—¥, `6`=å¹´æœˆæ—¥æ—¶åˆ†ç§’

---

## ä¸€ã€åˆ›å»ºå·¥ä½œè¡¨è§„èŒƒ

### 1.1 åŸºç¡€å·¥ä½œè¡¨åˆ›å»º

**API**: `POST /v3/app/worksheets`

**åŸºæœ¬ç»“æ„**:
```json
{
  "name": "å·¥ä½œè¡¨åç§°",
  "alias": "worksheet_alias",  // å¯é€‰,å»ºè®®ä½¿ç”¨è‹±æ–‡åˆ«å
  "sectionId": "group-id",     // å¯é€‰,æŒ‡å®šåˆ†ç»„
  "fields": [
    // å­—æ®µå®šä¹‰æ•°ç»„
  ]
}
```

**ç¤ºä¾‹ - åˆ›å»ºå®¢æˆ·ä¿¡æ¯è¡¨**:
```json
{
  "name": "å®¢æˆ·ä¿¡æ¯è¡¨",
  "alias": "customers",
  "fields": [
    {
      "name": "å®¢æˆ·åç§°",
      "alias": "customer_name",
      "type": "Text",
      "isTitle": true,      // æ ‡é¢˜å­—æ®µ
      "required": true      // å¿…å¡«
    },
    {
      "name": "å®¢æˆ·è¯„çº§",
      "alias": "rating",
      "type": "Rating",
      "max": 5,             // æœ€å¤§ç­‰çº§0-10
      "required": false
    }
  ]
}
```

---

### 1.2 ç‰¹æ®Šå­—æ®µç±»å‹å¤„ç†

#### 1.2.1 å•é€‰/å¤šé€‰å­—æ®µ (SingleSelect/MultipleSelect)

**åˆ›å»ºæ—¶å¿…é¡»æä¾›é€‰é¡¹**:

```json
{
  "name": "å®¢æˆ·ç±»å‹",
  "alias": "customer_type",
  "type": "SingleSelect",
  "options": [
    {"value": "æ½œåœ¨å®¢æˆ·", "index": 1},
    {"value": "æ„å‘å®¢æˆ·", "index": 2},
    {"value": "æˆäº¤å®¢æˆ·", "index": 3}
  ],
  "required": false
}
```

**å…³é”®ç‚¹**:
- âœ… å¿…é¡»æä¾› `options` æ•°ç»„
- âœ… æ¯ä¸ªé€‰é¡¹éœ€è¦ `value` (æ˜¾ç¤ºæ–‡æœ¬) å’Œ `index` (æ’åº)
- âš ï¸ ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªé€‰é¡¹ç”Ÿæˆå”¯ä¸€çš„ `key` (UUID)
- âš ï¸ åç»­æŸ¥è¯¢/æ›´æ–°æ—¶å¿…é¡»ä½¿ç”¨ `key`,ä¸èƒ½ç”¨ `value`

---

#### 1.2.2 å…³è”å­—æ®µ (Relation) â­é‡ç‚¹

**å…³è”å­—æ®µé…ç½®é¡¹**:

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|-----|------|------|------|
| `type` | string | âœ… | å¿…é¡»ä¸º "Relation" |
| `dataSource` | string | âœ… | å…³è”çš„ç›®æ ‡å·¥ä½œè¡¨ID |
| `subType` | string | âœ… | "1"=å•æ¡è®°å½•, "2"=å¤šæ¡è®°å½• |
| `relation` | object | âŒ | å…³è”é…ç½®è¯¦æƒ… |
| `relation.bidirectional` | boolean | âŒ | æ˜¯å¦åŒå‘å…³è” |
| `relation.showFields` | array | âŒ | å…³è”å¡ç‰‡æ˜¾ç¤ºçš„å­—æ®µIDåˆ—è¡¨ |

**ç¤ºä¾‹ - åˆ›å»ºå•æ¡å…³è”å­—æ®µ**:
```json
{
  "name": "å…³è”å®¢æˆ·",
  "alias": "related_customer",
  "type": "Relation",
  "subType": "1",                          // å•æ¡è®°å½•
  "dataSource": "696367c3b86aebd924a164f0", // ç›®æ ‡è¡¨ID
  "relation": {
    "bidirectional": false,                // å•å‘å…³è”
    "showFields": [                        // æ˜¾ç¤ºå­—æ®µ
      "customer_name",
      "customer_type"
    ]
  },
  "required": false
}
```

**ç¤ºä¾‹ - åˆ›å»ºå¤šæ¡å…³è”å­—æ®µ**:
```json
{
  "name": "å…³è”é¡¹ç›®",
  "alias": "related_projects",
  "type": "Relation",
  "subType": "2",                          // å¤šæ¡è®°å½•
  "dataSource": "696356193528addfe1b37e3c",
  "relation": {
    "bidirectional": true,                 // åŒå‘å…³è”
    "showFields": ["project_name", "project_status"]
  },
  "required": false
}
```

**âš ï¸ å…³è”å­—æ®µé‡è¦æ³¨æ„äº‹é¡¹**:

1. **dataSourceä¸å¯ä¿®æ”¹**: ä¸€æ—¦åˆ›å»º,å…³è”çš„ç›®æ ‡è¡¨ä¸èƒ½æ›´æ”¹,åªèƒ½åˆ é™¤é‡å»º
2. **å¿…é¡»å…ˆåˆ›å»ºç›®æ ‡è¡¨**: `dataSource` çš„å·¥ä½œè¡¨IDå¿…é¡»å·²å­˜åœ¨
3. **åŒå‘å…³è”è‡ªåŠ¨åˆ›å»º**: `bidirectional: true` ä¼šåœ¨ç›®æ ‡è¡¨è‡ªåŠ¨åˆ›å»ºåå‘å…³è”å­—æ®µ
4. **showFieldså¯ä¸ºç©º**: ä¸æä¾›æ—¶ä½¿ç”¨ç›®æ ‡è¡¨çš„æ ‡é¢˜å­—æ®µ
5. **å»ºè®®ä½¿ç”¨å­—æ®µID**: `showFields` ä½¿ç”¨å­—æ®µIDæ¯”åˆ«åæ›´ç¨³å®š

---

#### 1.2.3 æˆå‘˜å­—æ®µ (Collaborator)

```json
{
  "name": "è´Ÿè´£äºº",
  "alias": "owner",
  "type": "Collaborator",
  "subType": "0",  // 0=å•é€‰, 1=å¤šé€‰
  "required": false
}
```

---

#### 1.2.4 æ—¥æœŸ/æ—¶é—´å­—æ®µ (Date/DateTime/Time)

**Dateå­—æ®µ - subTypeæ§åˆ¶ç²¾åº¦**:

```json
{
  "name": "æˆç«‹æ—¥æœŸ",
  "alias": "founded_date",
  "type": "Date",
  "subType": "3",  // 5=å¹´, 4=å¹´æœˆ, 3=å¹´æœˆæ—¥, 2=å¹´æœˆæ—¥æ—¶, 1=å¹´æœˆæ—¥æ—¶åˆ†, 6=å¹´æœˆæ—¥æ—¶åˆ†ç§’
  "required": false
}
```

**Timeå­—æ®µ**:
```json
{
  "name": "å·¥ä½œæ—¶é—´",
  "alias": "work_time",
  "type": "Time",
  "subType": "1",  // 1=æ—¶:åˆ†, 6=æ—¶:åˆ†:ç§’
  "required": false
}
```

---

#### 1.2.5 æ•°å€¼å­—æ®µ (Number)

```json
{
  "name": "å¹´åº¦é¢„ç®—",
  "alias": "annual_budget",
  "type": "Number",
  "precision": 2,  // å°æ•°ä½æ•° 0-14
  "required": false
}
```

---

#### 1.2.6 ç­‰çº§å­—æ®µ (Rating)

```json
{
  "name": "å®¢æˆ·è¯„çº§",
  "alias": "customer_rating",
  "type": "Rating",
  "max": 5,  // æœ€å¤§ç­‰çº§ 0-10
  "required": false
}
```

---

#### 1.2.7 é™„ä»¶å­—æ®µ (Attachment)

```json
{
  "name": "é™„ä»¶",
  "alias": "attachments",
  "type": "Attachment",
  "required": false
}
```

**è¯´æ˜**: é™„ä»¶å­—æ®µåˆ›å»ºæ—¶æ— éœ€é¢å¤–å‚æ•°

---

### 1.3 å®Œæ•´åˆ›å»ºå·¥ä½œè¡¨ç¤ºä¾‹

**åœºæ™¯**: åˆ›å»ºé”€å”®æœºä¼šè¡¨,åŒ…å«å…³è”å®¢æˆ·

```json
{
  "name": "é”€å”®æœºä¼šè¡¨",
  "alias": "opportunities",
  "fields": [
    {
      "name": "æœºä¼šåç§°",
      "alias": "opportunity_name",
      "type": "Text",
      "isTitle": true,
      "required": true
    },
    {
      "name": "å…³è”å®¢æˆ·",
      "alias": "related_customer",
      "type": "Relation",
      "subType": "1",
      "dataSource": "696367c3b86aebd924a164f0",  // å®¢æˆ·è¡¨ID
      "relation": {
        "bidirectional": false,
        "showFields": ["customer_name", "customer_type"]
      },
      "required": true
    },
    {
      "name": "é”€å”®é˜¶æ®µ",
      "alias": "stage",
      "type": "SingleSelect",
      "options": [
        {"value": "åˆæ¬¡æ¥è§¦", "index": 1},
        {"value": "éœ€æ±‚ç¡®è®¤", "index": 2},
        {"value": "æ–¹æ¡ˆæŠ¥ä»·", "index": 3},
        {"value": "å•†åŠ¡è°ˆåˆ¤", "index": 4},
        {"value": "èµ¢å•", "index": 5}
      ],
      "required": false
    },
    {
      "name": "é¢„è®¡é‡‘é¢",
      "alias": "expected_amount",
      "type": "Number",
      "precision": 2,
      "required": false
    },
    {
      "name": "é¢„è®¡æˆäº¤æ—¥æœŸ",
      "alias": "close_date",
      "type": "Date",
      "subType": "3",
      "required": false
    },
    {
      "name": "æˆå•æ¦‚ç‡",
      "alias": "win_probability",
      "type": "SingleSelect",
      "options": [
        {"value": "30%", "index": 1},
        {"value": "50%", "index": 2},
        {"value": "70%", "index": 3},
        {"value": "90%", "index": 4}
      ],
      "required": false
    }
  ]
}
```

---

## äºŒã€å­—æ®µç±»å‹å‚æ•°è¯¦è§£

### 2.1 å­—æ®µç±»å‹å¯¹ç…§è¡¨

| å­—æ®µç±»å‹ | typeå€¼ | å¿…éœ€å‚æ•° | å¯é€‰å‚æ•° | è¯´æ˜ |
|---------|--------|---------|---------|------|
| æ–‡æœ¬ | Text | name | alias, required, isTitle, isUnique, isReadOnly, isHidden, isHiddenOnCreate | åŸºç¡€æ–‡æœ¬å­—æ®µ |
| æ•°å€¼ | Number | name | precision (0-14), alias, required | æ”¯æŒå°æ•° |
| å•é€‰ | SingleSelect | name, options | alias, required | å¿…é¡»æä¾›é€‰é¡¹ |
| å¤šé€‰ | MultipleSelect | name, options | alias, required | å¿…é¡»æä¾›é€‰é¡¹ |
| æ—¥æœŸ | Date | name | subType (5/4/3/2/1/6), alias, required | ä¸åŒç²¾åº¦ |
| æ—¥æœŸæ—¶é—´ | DateTime | name | subType (5/4/3/2/1/6), alias, required | åŒDate,ç”¨äºå…¼å®¹ |
| æ—¶é—´ | Time | name | subType (1/6), alias, required | æ—¶åˆ†æˆ–æ—¶åˆ†ç§’ |
| æˆå‘˜ | Collaborator | name | subType (0/1), alias, required | å•é€‰æˆ–å¤šé€‰ |
| éƒ¨é—¨ | Department | name | subType (0/1), alias, required | å•é€‰æˆ–å¤šé€‰éƒ¨é—¨ |
| åœ°åŒº | Region | name | alias, required | çœå¸‚åŒºé€‰æ‹© |
| å…³è”è®°å½• | Relation | name, dataSource, subType | relation, alias, required | å¿…é¡»æŒ‡å®šç›®æ ‡è¡¨ |
| é™„ä»¶ | Attachment | name | alias, required | æ”¯æŒURLå’Œbase64 |
| ç­‰çº§ | Rating | name | max (0-10), alias, required | æ˜Ÿçº§è¯„åˆ† |

---

### 2.2 subTypeå‚æ•°è¯¦è§£

**Collaborator (æˆå‘˜å­—æ®µ)**:
- `"0"` - å•é€‰æˆå‘˜
- `"1"` - å¤šé€‰æˆå‘˜

**Relation (å…³è”å­—æ®µ)**:
- `"1"` - å•æ¡è®°å½•
- `"2"` - å¤šæ¡è®°å½•

**Time (æ—¶é—´å­—æ®µ)**:
- `"1"` - æ—¶:åˆ† (HH:mm)
- `"6"` - æ—¶:åˆ†:ç§’ (HH:mm:ss)

**Date/DateTime (æ—¥æœŸå­—æ®µ)**:
- `"5"` - å¹´ (YYYY)
- `"4"` - å¹´æœˆ (YYYY-MM)
- `"3"` - å¹´æœˆæ—¥ (YYYY-MM-DD)
- `"2"` - å¹´æœˆæ—¥æ—¶ (YYYY-MM-DD HH)
- `"1"` - å¹´æœˆæ—¥æ—¶åˆ† (YYYY-MM-DD HH:mm)
- `"6"` - å¹´æœˆæ—¥æ—¶åˆ†ç§’ (YYYY-MM-DD HH:mm:ss)

---

### 2.3 å­—æ®µçº¦æŸå‚æ•°

| å‚æ•° | ç±»å‹ | è¯´æ˜ | é€‚ç”¨å­—æ®µ |
|-----|------|------|---------|
| `required` | boolean | æ˜¯å¦å¿…å¡« | æ‰€æœ‰å­—æ®µ |
| `isTitle` | boolean | æ˜¯å¦ä¸ºæ ‡é¢˜å­—æ®µ | Text |
| `isUnique` | boolean | æ˜¯å¦å”¯ä¸€ | Text, Number |
| `isReadOnly` | boolean | æ˜¯å¦åªè¯» | æ‰€æœ‰å­—æ®µ |
| `isHidden` | boolean | æ˜¯å¦éšè— | æ‰€æœ‰å­—æ®µ |
| `isHiddenOnCreate` | boolean | åˆ›å»ºæ—¶éšè— | æ‰€æœ‰å­—æ®µ |

---

## ä¸‰ã€åˆ›å»º/æ›´æ–°è®°å½•è§„èŒƒ

### 3.1 åˆ›å»ºè®°å½• API

**API**: `POST /v3/app/worksheets/{worksheet_id}/rows`

**è¯·æ±‚ä½“ç»“æ„**:
```json
{
  "fields": [
    {"id": "field_id_or_alias", "value": "å¯¹åº”å€¼"}
  ],
  "triggerWorkflow": true  // æ˜¯å¦è§¦å‘å·¥ä½œæµ,é»˜è®¤true
}
```

---

### 3.2 triggerWorkflow å‚æ•°è¯¦è§£ â­é‡è¦

`triggerWorkflow` å‚æ•°æ§åˆ¶æ˜¯å¦åœ¨æ•°æ®æ“ä½œæ—¶è§¦å‘å·¥ä½œè¡¨ç›¸å…³çš„å·¥ä½œæµã€‚

**é€‚ç”¨èŒƒå›´**:
- âœ… åˆ›å»ºè®°å½•: `POST /v3/app/worksheets/{worksheet_id}/rows`
- âœ… æ‰¹é‡åˆ›å»º: `POST /v3/app/worksheets/{worksheet_id}/rows/batch`
- âœ… æ›´æ–°è®°å½•: `POST /v3/app/worksheets/{worksheet_id}/rows/{row_id}`
- âœ… æ‰¹é‡æ›´æ–°: `PUT /v3/app/worksheets/{worksheet_id}/rows/batch`
- âœ… åˆ é™¤è®°å½•: `DELETE /v3/app/worksheets/{worksheet_id}/rows/{row_id}`
- âœ… æ‰¹é‡åˆ é™¤: `DELETE /v3/app/worksheets/{worksheet_id}/rows/batch`

**å‚æ•°è¯´æ˜**:

| å‚æ•°å€¼ | è¯´æ˜ | é»˜è®¤å€¼ | ä½¿ç”¨åœºæ™¯ |
|-------|------|--------|----------|
| `true` | è§¦å‘å·¥ä½œæµ | âœ… æ˜¯ | æ­£å¸¸ä¸šåŠ¡æ“ä½œ,éœ€è¦æ‰§è¡Œè‡ªåŠ¨åŒ–æµç¨‹ |
| `false` | ä¸è§¦å‘å·¥ä½œæµ | âŒ å¦ | æ•°æ®è¿ç§»ã€æ‰¹é‡åˆå§‹åŒ–ã€æµ‹è¯•æ•°æ® |

**å·¥ä½œæµè§¦å‘æ—¶æœº**:

å·¥ä½œæµæ ¹æ®è§¦å‘æ¡ä»¶é…ç½®å†³å®šæ˜¯å¦æ‰§è¡Œ:
- **æ–°å¢è®°å½•æ—¶**: è§¦å‘"å½“è®°å½•è¢«æ–°å¢æ—¶"ç±»å‹çš„å·¥ä½œæµ
- **æ›´æ–°è®°å½•æ—¶**: è§¦å‘"å½“è®°å½•è¢«æ›´æ–°æ—¶"ç±»å‹çš„å·¥ä½œæµ
- **åˆ é™¤è®°å½•æ—¶**: è§¦å‘"å½“è®°å½•è¢«åˆ é™¤æ—¶"ç±»å‹çš„å·¥ä½œæµ
- **å­—æ®µå˜æ›´æ—¶**: è§¦å‘ç‰¹å®šå­—æ®µå€¼å˜åŒ–çš„å·¥ä½œæµ

**ä½¿ç”¨å»ºè®®**:

**âœ… åº”è¯¥è®¾ç½®ä¸º `true` çš„åœºæ™¯**:

1. **æ­£å¸¸ä¸šåŠ¡æ“ä½œ**
```javascript
// åˆ›å»ºé”€å”®æœºä¼š,è§¦å‘è‡ªåŠ¨åˆ†é…è´Ÿè´£äººå·¥ä½œæµ
await createRecord({
  fields: [...],
  triggerWorkflow: true  // è§¦å‘å·¥ä½œæµ
});
```

2. **ç”¨æˆ·æäº¤è¡¨å•**
```javascript
// å®¢æˆ·æäº¤è®¢å•,è§¦å‘é€šçŸ¥å’Œå®¡æ‰¹æµç¨‹
await createRecord({
  fields: orderData,
  triggerWorkflow: true
});
```

3. **éœ€è¦è‡ªåŠ¨åŒ–å¤„ç†çš„æ“ä½œ**
```javascript
// æ›´æ–°å®¢æˆ·çŠ¶æ€,è§¦å‘å®¢æˆ·è·Ÿè¿›æé†’
await updateRecord(worksheetId, rowId, {
  fields: [{id: "status", value: ["å·²æˆäº¤"]}],
  triggerWorkflow: true  // è§¦å‘è·Ÿè¿›å·¥ä½œæµ
});
```

**âŒ åº”è¯¥è®¾ç½®ä¸º `false` çš„åœºæ™¯**:

1. **æ•°æ®è¿ç§»å’Œå¯¼å…¥**
```javascript
// ä»æ—§ç³»ç»Ÿè¿ç§»æ•°æ®,ä¸éœ€è¦è§¦å‘é€šçŸ¥
await batchCreateRecords({
  rows: migratedData,
  triggerWorkflow: false  // é¿å…å¤§é‡å·¥ä½œæµæ‰§è¡Œ
});
```

2. **æ‰¹é‡æ•°æ®åˆå§‹åŒ–**
```javascript
// åˆå§‹åŒ–æµ‹è¯•æ•°æ®
await batchCreateRecords({
  rows: testData,
  triggerWorkflow: false  // ä¸è§¦å‘å·¥ä½œæµ
});
```

3. **å®šæ—¶åŒæ­¥ä»»åŠ¡**
```javascript
// å®šæ—¶ä»å¤–éƒ¨ç³»ç»ŸåŒæ­¥æ•°æ®
async function syncExternalData() {
  const externalData = await fetchFromExternalSystem();

  await batchCreateRecords({
    rows: externalData,
    triggerWorkflow: false  // é¿å…é‡å¤è§¦å‘å·¥ä½œæµ
  });
}
```

4. **æµ‹è¯•å’Œè°ƒè¯•**
```javascript
// æµ‹è¯•æ•°æ®å†™å…¥é€»è¾‘
await createRecord({
  fields: testFields,
  triggerWorkflow: false  // æµ‹è¯•æ—¶ä¸è§¦å‘å·¥ä½œæµ
});
```

**æ€§èƒ½å½±å“**:

å·¥ä½œæµæ‰§è¡Œä¼šå¢åŠ APIå“åº”æ—¶é—´:
- âœ… `triggerWorkflow: false` - API å“åº”å¿«,é€šå¸¸ < 500ms
- âš ï¸ `triggerWorkflow: true` - éœ€è¦ç­‰å¾…å·¥ä½œæµæ‰§è¡Œ,å¯èƒ½éœ€è¦ 1-5 ç§’

**æ‰¹é‡æ“ä½œæ—¶çš„æ³¨æ„äº‹é¡¹**:

```javascript
// âŒ é”™è¯¯: æ‰¹é‡æ“ä½œæ—¶è§¦å‘å¤§é‡å·¥ä½œæµå¯èƒ½å¯¼è‡´è¶…æ—¶
await batchCreateRecords({
  rows: Array(1000).fill({...}),  // 1000æ¡è®°å½•
  triggerWorkflow: true  // ä¼šè§¦å‘1000æ¬¡å·¥ä½œæµ!
});

// âœ… æ­£ç¡®: åˆ†æ‰¹å¤„ç†,æˆ–å…³é—­å·¥ä½œæµè§¦å‘
// æ–¹æ¡ˆ1: å…³é—­å·¥ä½œæµ
await batchCreateRecords({
  rows: records,
  triggerWorkflow: false
});

// æ–¹æ¡ˆ2: åˆ†æ‰¹å¤„ç†,æ§åˆ¶å¹¶å‘
for (let i = 0; i < records.length; i += 50) {
  const batch = records.slice(i, i + 50);
  await batchCreateRecords({
    rows: batch,
    triggerWorkflow: true
  });
  await sleep(2000);  // æ‰¹æ¬¡é—´å»¶è¿Ÿ
}
```

**å·¥ä½œæµè§¦å‘å¼‚å¸¸å¤„ç†**:

```javascript
async function createRecordWithWorkflow(fields) {
  try {
    const result = await createRecord({
      fields: fields,
      triggerWorkflow: true
    });

    // APIæˆåŠŸä¸ä»£è¡¨å·¥ä½œæµæ‰§è¡ŒæˆåŠŸ
    // å·¥ä½œæµå¼‚å¸¸ä¸ä¼šå½±å“è®°å½•åˆ›å»º
    console.log('è®°å½•åˆ›å»ºæˆåŠŸ:', result.row_id);

    // å¦‚éœ€ç¡®è®¤å·¥ä½œæµæ‰§è¡Œç»“æœ,éœ€æŸ¥çœ‹å·¥ä½œæµæ‰§è¡Œæ—¥å¿—

  } catch (error) {
    console.error('è®°å½•åˆ›å»ºå¤±è´¥:', error);
  }
}
```

**âš ï¸ é‡è¦æç¤º**:

1. **è®°å½•æ“ä½œä¸å·¥ä½œæµæ‰§è¡Œæ˜¯å¼‚æ­¥çš„**
   - API è¿”å›æˆåŠŸåªè¡¨ç¤ºè®°å½•æ“ä½œæˆåŠŸ
   - å·¥ä½œæµåœ¨åå°å¼‚æ­¥æ‰§è¡Œ
   - å·¥ä½œæµæ‰§è¡Œå¤±è´¥ä¸ä¼šå½±å“è®°å½•æ“ä½œ

2. **å·¥ä½œæµè§¦å‘æ¡ä»¶**
   - å³ä½¿è®¾ç½® `triggerWorkflow: true`,å·¥ä½œæµä¹Ÿéœ€è¦æ»¡è¶³è‡ªèº«é…ç½®çš„è§¦å‘æ¡ä»¶
   - ä¾‹å¦‚:è®¾ç½®äº†"ä»…å½“çŠ¶æ€=å·²å®Œæˆ"çš„å·¥ä½œæµ,åˆ›å»ºè‰ç¨¿è®°å½•ä¸ä¼šè§¦å‘

3. **å·¥ä½œæµæ‰§è¡Œé™åˆ¶**
   - æ˜é“äº‘å¯¹å·¥ä½œæµæ‰§è¡Œæœ‰é¢‘ç‡é™åˆ¶
   - çŸ­æ—¶é—´å†…å¤§é‡è§¦å‘å¯èƒ½è¢«é™æµ
   - æ‰¹é‡æ“ä½œæ—¶å»ºè®®å…³é—­å·¥ä½œæµè§¦å‘

4. **åˆ é™¤æ“ä½œçš„å·¥ä½œæµ**
   - é€»è¾‘åˆ é™¤(`permanent: false`)ä¼šè§¦å‘"è®°å½•è¢«åˆ é™¤"å·¥ä½œæµ
   - ç‰©ç†åˆ é™¤(`permanent: true`)å¯èƒ½æ— æ³•è§¦å‘å·¥ä½œæµ,å› ä¸ºè®°å½•å·²å½»åº•åˆ é™¤

**æœ€ä½³å®è·µ**:

```javascript
// å°è£…è®°å½•åˆ›å»ºå‡½æ•°,æ ¹æ®åœºæ™¯å†³å®šæ˜¯å¦è§¦å‘å·¥ä½œæµ
async function smartCreateRecord(fields, options = {}) {
  const {
    isMigration = false,     // æ˜¯å¦ä¸ºæ•°æ®è¿ç§»
    isBatch = false,          // æ˜¯å¦ä¸ºæ‰¹é‡æ“ä½œ
    isTest = false            // æ˜¯å¦ä¸ºæµ‹è¯•
  } = options;

  // è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦è§¦å‘å·¥ä½œæµ
  const triggerWorkflow = !(isMigration || (isBatch && fields.length > 50) || isTest);

  return await createRecord({
    fields: fields,
    triggerWorkflow: triggerWorkflow
  });
}

// ä½¿ç”¨ç¤ºä¾‹
await smartCreateRecord(fields, { isMigration: true });  // è¿ç§»æ•°æ®,ä¸è§¦å‘
await smartCreateRecord(fields, { isBatch: true });       // æ‰¹é‡æ“ä½œ,è‡ªåŠ¨åˆ¤æ–­
await smartCreateRecord(fields);                          // æ­£å¸¸æ“ä½œ,è§¦å‘å·¥ä½œæµ
```

---

### 3.3 å„å­—æ®µç±»å‹ä¼ å‚ç¤ºä¾‹

#### 3.3.1 æ–‡æœ¬å­—æ®µ (Text)

```json
{
  "id": "customer_name",
  "value": "æ˜é“äº‘ç§‘æŠ€æœ‰é™å…¬å¸"
}
```

---

#### 3.3.2 æ•°å€¼å­—æ®µ (Number)

**å†™å…¥**: ä¼ æ•°å­—ç±»å‹
```json
{
  "id": "annual_budget",
  "value": 1000000.50
}
```

**è¯»å–**: è¿”å›å­—ç¬¦ä¸²
```json
{
  "annual_budget": "1000000.50"
}
```

âš ï¸ **æ³¨æ„**: å†™å…¥æ•°å­—,è¯»å–å­—ç¬¦ä¸²

---

#### 3.3.3 å•é€‰å­—æ®µ (SingleSelect) â­é‡ç‚¹

**å†™å…¥**: å¿…é¡»ä¼ é€‰é¡¹keyçš„æ•°ç»„
```json
{
  "id": "customer_type",
  "value": ["74c7b607-864d-4cc4-b401-28acba2636e9"]  // é€‰é¡¹key
}
```

**è¯»å–**: è¿”å›åŒ…å«keyå’Œvalueçš„å¯¹è±¡æ•°ç»„
```json
{
  "customer_type": [
    {
      "key": "74c7b607-864d-4cc4-b401-28acba2636e9",
      "value": "æˆäº¤å®¢æˆ·"
    }
  ]
}
```

**âš ï¸ å…³é”®ç‚¹**:
1. å³ä½¿æ˜¯å•é€‰,ä¹Ÿè¦ç”¨æ•°ç»„ `["key"]`
2. ä¸èƒ½ä¼ æ˜¾ç¤ºæ–‡æœ¬ `["æˆäº¤å®¢æˆ·"]`,å¿…é¡»ç”¨key
3. æ–°å¢é€‰é¡¹æ—¶å¯è®¾ç½® `type` å‚æ•°

**æ”¯æŒçš„typeå‚æ•°**:
```json
{
  "id": "customer_type",
  "type": "2",  // 1=ä¸å…è®¸æ–°å¢é€‰é¡¹(é»˜è®¤), 2=å…è®¸æ–°å¢é€‰é¡¹
  "value": ["æ–°é€‰é¡¹åç§°"]
}
```

---

#### 3.3.4 å¤šé€‰å­—æ®µ (MultipleSelect)

**å†™å…¥**: ä¼ å¤šä¸ªé€‰é¡¹keyçš„æ•°ç»„
```json
{
  "id": "customer_tags",
  "value": [
    "705de83e-b929-43e4-82ff-fff2f7dd6888",  // é‡ç‚¹å®¢æˆ·
    "422b4e56-263f-4bfa-bc88-77c09811080e",  // VIP
    "a2ef7406-a9b1-4fc8-ba02-33aa172998d0"   // é•¿æœŸåˆä½œ
  ]
}
```

**è¯»å–**: è¿”å›å¯¹è±¡æ•°ç»„
```json
{
  "customer_tags": [
    {"key": "705de83e-b929-43e4-82ff-fff2f7dd6888", "value": "é‡ç‚¹å®¢æˆ·"},
    {"key": "422b4e56-263f-4bfa-bc88-77c09811080e", "value": "VIP"},
    {"key": "a2ef7406-a9b1-4fc8-ba02-33aa172998d0", "value": "é•¿æœŸåˆä½œ"}
  ]
}
```

---

#### 3.3.5 æ—¥æœŸå­—æ®µ (Date)

**å†™å…¥**: ä¼ å­—ç¬¦ä¸²æ ¼å¼
```json
{
  "id": "founded_date",
  "value": "2025-01-11"  // YYYY-MM-DD
}
```

**æ—¥æœŸæ—¶é—´æ ¼å¼**:
```json
{
  "id": "created_datetime",
  "value": "2025-01-11 14:30:45"  // YYYY-MM-DD HH:mm:ss
}
```

**è¯»å–**: è¿”å›å­—ç¬¦ä¸²
```json
{
  "founded_date": "2025-01-11"
}
```

---

#### 3.3.6 æ—¶é—´å­—æ®µ (Time)

```json
{
  "id": "work_time",
  "value": "14:30:45"  // HH:mm:ss æˆ– HH:mm
}
```

---

#### 3.3.7 ç­‰çº§å­—æ®µ (Rating)

**å†™å…¥**: ä¼ å­—ç¬¦ä¸²æ ¼å¼çš„æ•°å­—
```json
{
  "id": "customer_rating",
  "value": "5"  // å­—ç¬¦ä¸²æ ¼å¼
}
```

**è¯»å–**: è¿”å›å­—ç¬¦ä¸²
```json
{
  "customer_rating": "5"
}
```

---

#### 3.3.8 æˆå‘˜å­—æ®µ (Collaborator) â­é‡ç‚¹

**å†™å…¥**: ä¼ ç”¨æˆ·IDæ•°ç»„
```json
{
  "id": "owner",
  "value": ["user-account-id-123"]  // ç”¨æˆ·ID,ä¸æ˜¯ç”¨æˆ·å
}
```

**è·å–ç”¨æˆ·ID**: ä½¿ç”¨æŸ¥æ‰¾ç”¨æˆ·API
```bash
POST /v3/users/lookup
{
  "name": "å¼ ä¸‰"  // ç²¾ç¡®åŒ¹é…å§“å
}

# è¿”å›
{
  "accountId": "user-account-id-123",
  "fullname": "å¼ ä¸‰",
  "email": "zhangsan@example.com"
}
```

**è¯»å–**: è¿”å›ç”¨æˆ·å¯¹è±¡æˆ–å¯¹è±¡æ•°ç»„
```json
{
  "owner": {
    "accountId": "user-account-id-123",
    "fullname": "å¼ ä¸‰",
    "avatar": "https://...",
    "email": "zhangsan@example.com",
    "status": 1
  }
}
```

---

#### 3.3.9 éƒ¨é—¨å­—æ®µ (Department) â­æ–°å¢

éƒ¨é—¨å­—æ®µç”¨äºé€‰æ‹©ç»„ç»‡æ¶æ„ä¸­çš„éƒ¨é—¨,ä¸æˆå‘˜å­—æ®µç±»ä¼¼,ä¹Ÿæ”¯æŒå•é€‰å’Œå¤šé€‰ã€‚

**å­—æ®µåˆ›å»º**:
```json
{
  "name": "æ‰€å±éƒ¨é—¨",
  "alias": "department",
  "type": "Department",
  "subType": "0",  // 0=å•é€‰, 1=å¤šé€‰
  "required": false
}
```

**å•é€‰éƒ¨é—¨å†™å…¥**: ä¼ éƒ¨é—¨IDæ•°ç»„
```json
{
  "id": "department",
  "value": ["department-id-123"]  // éƒ¨é—¨ID,ä¸æ˜¯éƒ¨é—¨åç§°
}
```

**å¤šé€‰éƒ¨é—¨å†™å…¥**: ä¼ å¤šä¸ªéƒ¨é—¨ID
```json
{
  "id": "departments",
  "value": [
    "department-id-123",
    "department-id-456"
  ]
}
```

**è·å–éƒ¨é—¨ID**: ä½¿ç”¨æŸ¥æ‰¾éƒ¨é—¨API

**æ–¹æ³•1: é€šè¿‡åç§°æŸ¥æ‰¾**
```bash
POST /v3/departments/lookup
{
  "name": "é”€å”®éƒ¨"  // ç²¾ç¡®åŒ¹é…éƒ¨é—¨åç§°
}

# è¿”å›
{
  "success": true,
  "data": {
    "departmentId": "department-id-123",
    "departmentName": "é”€å”®éƒ¨",
    "parentId": "parent-dept-id",
    "level": 2
  }
}
```

**æ–¹æ³•2: è·å–éƒ¨é—¨åˆ—è¡¨**
```bash
GET /v3/departments

# è¿”å›ç»„ç»‡æ¶æ„æ ‘
{
  "success": true,
  "data": [
    {
      "departmentId": "dept-001",
      "departmentName": "æ€»è£åŠ",
      "children": [
        {
          "departmentId": "dept-002",
          "departmentName": "è¡Œæ”¿éƒ¨"
        }
      ]
    },
    {
      "departmentId": "dept-003",
      "departmentName": "é”€å”®ä¸­å¿ƒ",
      "children": [
        {
          "departmentId": "dept-004",
          "departmentName": "åä¸œåŒºé”€å”®éƒ¨"
        }
      ]
    }
  ]
}
```

**å•é€‰éƒ¨é—¨è¯»å–**: è¿”å›éƒ¨é—¨å¯¹è±¡
```json
{
  "department": {
    "departmentId": "department-id-123",
    "departmentName": "é”€å”®éƒ¨"
  }
}
```

**å¤šé€‰éƒ¨é—¨è¯»å–**: è¿”å›éƒ¨é—¨å¯¹è±¡æ•°ç»„
```json
{
  "departments": [
    {
      "departmentId": "department-id-123",
      "departmentName": "é”€å”®éƒ¨"
    },
    {
      "departmentId": "department-id-456",
      "departmentName": "å¸‚åœºéƒ¨"
    }
  ]
}
```

**éƒ¨é—¨å­—æ®µç­›é€‰**:
```json
{
  "type": "group",
  "logic": "AND",
  "children": [
    {
      "type": "condition",
      "field": "department",
      "operator": "eq",
      "value": ["department-id-123"]  // ä½¿ç”¨éƒ¨é—¨ID
    }
  ]
}
```

**âš ï¸ å…³é”®ç‚¹**:
1. å¿…é¡»ä½¿ç”¨éƒ¨é—¨ID,ä¸èƒ½ä½¿ç”¨éƒ¨é—¨åç§°
2. éœ€è¦å…ˆé€šè¿‡ `/v3/departments/lookup` æŸ¥æ‰¾éƒ¨é—¨ID
3. éƒ¨é—¨IDæ ¼å¼é€šå¸¸ä¸º UUID å­—ç¬¦ä¸²
4. æ”¯æŒå•é€‰(`subType: "0"`)å’Œå¤šé€‰(`subType: "1"`)
5. ç­›é€‰æ—¶ä½¿ç”¨ `eq` æ“ä½œç¬¦

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
// 1. æŸ¥æ‰¾éƒ¨é—¨ID
const dept = await findDepartment({ name: "é”€å”®éƒ¨" });
const deptId = dept.data.departmentId;

// 2. åˆ›å»ºè®°å½•æ—¶è®¾ç½®éƒ¨é—¨
await createRecord({
  fields: [
    {
      "id": "department",
      "value": [deptId]
    }
  ]
});

// 3. ç­›é€‰æŸä¸ªéƒ¨é—¨çš„è®°å½•
const records = await queryRecords({
  filter: {
    type: "group",
    logic: "AND",
    children: [{
      type: "condition",
      field: "department",
      operator: "eq",
      value: [deptId]
    }]
  }
});
```

---

#### 3.2.10 åœ°åŒºå­—æ®µ (Region) â­æ–°å¢

åœ°åŒºå­—æ®µç”¨äºé€‰æ‹©çœå¸‚åŒºç­‰åœ°ç†åŒºåŸŸ,æ”¯æŒä¸åŒçº§åˆ«çš„åœ°åŒºé€‰æ‹©ã€‚

**å­—æ®µåˆ›å»º**:
```json
{
  "name": "æ‰€åœ¨åœ°åŒº",
  "alias": "region",
  "type": "Region",
  "required": false
}
```

**åœ°åŒºå­—æ®µå†™å…¥**: ä¼ åœ°åŒºç¼–ç å­—ç¬¦ä¸²
```json
{
  "id": "region",
  "value": "310100"  // ä¸Šæµ·å¸‚å¸‚è¾–åŒºçš„åœ°åŒºç¼–ç 
}
```

**è·å–åœ°åŒºç¼–ç **: ä½¿ç”¨åœ°åŒºä¿¡æ¯API

**æ–¹æ³•1: é€šè¿‡åç§°æœç´¢åœ°åŒº**
```bash
POST /v3/regions
{
  "search": "ä¸Šæµ·"
}

# è¿”å›åŒ¹é…çš„åœ°åŒºåˆ—è¡¨
{
  "success": true,
  "data": [
    {
      "id": "310000",
      "name": "ä¸Šæµ·å¸‚",
      "parentId": null,
      "level": 1  // 1=çœ, 2=å¸‚, 3=åŒºå¿
    },
    {
      "id": "310100",
      "name": "å¸‚è¾–åŒº",
      "parentId": "310000",
      "level": 2
    }
  ]
}
```

**æ–¹æ³•2: è·å–å­çº§åœ°åŒº**
```bash
POST /v3/regions
{
  "id": "310000"  // ä¸Šæµ·å¸‚çš„ID
}

# è¿”å›ä¸Šæµ·å¸‚ä¸‹çš„æ‰€æœ‰åŒºå¿
{
  "success": true,
  "data": [
    {
      "id": "310100",
      "name": "å¸‚è¾–åŒº",
      "parentId": "310000",
      "level": 2
    },
    {
      "id": "310101",
      "name": "é»„æµ¦åŒº",
      "parentId": "310100",
      "level": 3
    },
    {
      "id": "310104",
      "name": "å¾æ±‡åŒº",
      "parentId": "310100",
      "level": 3
    }
  ]
}
```

**åœ°åŒºå­—æ®µè¯»å–**:
```json
{
  "region": {
    "id": "310100",
    "name": "ä¸Šæµ·å¸‚-å¸‚è¾–åŒº",
    "code": "310100"
  }
}
```

**åœ°åŒºå­—æ®µç­›é€‰**:
```json
{
  "type": "group",
  "logic": "AND",
  "children": [
    {
      "type": "condition",
      "field": "region",
      "operator": "eq",
      "value": ["310100"]  // ä½¿ç”¨åœ°åŒºç¼–ç 
    }
  ]
}
```

**æ•°æ®é€è§†åˆ†æä¸­ä½¿ç”¨åœ°åŒºå­—æ®µ**:

åœ°åŒºå­—æ®µæ”¯æŒæŒ‰ä¸åŒç²’åº¦è¿›è¡Œç»Ÿè®¡:

```json
{
  "rows": [
    {
      "field": "region",
      "displayName": "æ‰€åœ¨åœ°åŒº",
      "granularity": 1,  // 1=çœ, 2=çœ/å¸‚, 3=çœ/å¸‚/åŒºå¿
      "includeEmpty": false
    }
  ],
  "values": [
    {
      "field": "rowid",
      "aggregation": "COUNT",
      "displayName": "å®¢æˆ·æ•°é‡"
    }
  ]
}
```

**granularity å‚æ•°è¯´æ˜**:
- `1` - æŒ‰çœç»Ÿè®¡(ä¾‹å¦‚: ä¸Šæµ·å¸‚ã€åŒ—äº¬å¸‚)
- `2` - æŒ‰çœ/å¸‚ç»Ÿè®¡(ä¾‹å¦‚: ä¸Šæµ·å¸‚-å¸‚è¾–åŒºã€åŒ—äº¬å¸‚-å¸‚è¾–åŒº)
- `3` - æŒ‰çœ/å¸‚/åŒºå¿ç»Ÿè®¡(ä¾‹å¦‚: ä¸Šæµ·å¸‚-å¸‚è¾–åŒº-é»„æµ¦åŒº)

**âš ï¸ å…³é”®ç‚¹**:
1. åœ°åŒºå­—æ®µå€¼æ˜¯åœ°åŒºç¼–ç å­—ç¬¦ä¸²,ä¸æ˜¯åœ°åŒºåç§°
2. éœ€è¦å…ˆé€šè¿‡ `/v3/regions` API æŸ¥æ‰¾åœ°åŒºç¼–ç 
3. åœ°åŒºç¼–ç æ˜¯å›½å®¶æ ‡å‡†è¡Œæ”¿åŒºåˆ’ä»£ç 
4. ç­›é€‰æ—¶ä½¿ç”¨ `eq` æ“ä½œç¬¦
5. é€è§†åˆ†ææ—¶å¯ä½¿ç”¨ `granularity` å‚æ•°æ§åˆ¶ç»Ÿè®¡ç²’åº¦

**ä½¿ç”¨ç¤ºä¾‹**:
```javascript
// 1. æœç´¢åœ°åŒºç¼–ç 
const regions = await getRegions({ search: "ä¸Šæµ·" });
const regionCode = regions.data[0].id;  // "310000"

// 2. åˆ›å»ºè®°å½•æ—¶è®¾ç½®åœ°åŒº
await createRecord({
  fields: [
    {
      "id": "region",
      "value": regionCode
    }
  ]
});

// 3. ç­›é€‰æŸä¸ªåœ°åŒºçš„è®°å½•
const records = await queryRecords({
  filter: {
    type: "group",
    logic: "AND",
    children: [{
      type: "condition",
      field: "region",
      operator: "eq",
      value: [regionCode]
    }]
  }
});

// 4. æŒ‰çœç»Ÿè®¡å®¢æˆ·åˆ†å¸ƒ
const pivotData = await getPivotData({
  rows: [{
    field: "region",
    granularity: 1  // æŒ‰çœç»Ÿè®¡
  }],
  values: [{
    field: "rowid",
    aggregation: "COUNT"
  }]
});
```

**åœ°åŒºæ•°æ®å±‚çº§ç»“æ„ç¤ºä¾‹**:
```
ä¸­å›½
  â”œâ”€â”€ åŒ—äº¬å¸‚ (110000) - ç›´è¾–å¸‚
  â”‚    â””â”€â”€ å¸‚è¾–åŒº (110100)
  â”‚         â”œâ”€â”€ ä¸œåŸåŒº (110101)
  â”‚         â”œâ”€â”€ è¥¿åŸåŒº (110102)
  â”‚         â””â”€â”€ ...
  â”œâ”€â”€ ä¸Šæµ·å¸‚ (310000) - ç›´è¾–å¸‚
  â”‚    â””â”€â”€ å¸‚è¾–åŒº (310100)
  â”‚         â”œâ”€â”€ é»„æµ¦åŒº (310101)
  â”‚         â”œâ”€â”€ å¾æ±‡åŒº (310104)
  â”‚         â””â”€â”€ ...
  â””â”€â”€ å¹¿ä¸œçœ (440000) - çœ
       â”œâ”€â”€ å¹¿å·å¸‚ (440100)
       â”‚    â”œâ”€â”€ è¶Šç§€åŒº (440103)
       â”‚    â””â”€â”€ ...
       â”œâ”€â”€ æ·±åœ³å¸‚ (440300)
       â”‚    â”œâ”€â”€ ç½—æ¹–åŒº (440303)
       â”‚    â””â”€â”€ ...
       â””â”€â”€ ...
```

**å¸¸è§åœ°åŒºç¼–ç **:
- åŒ—äº¬å¸‚: `110000`
- ä¸Šæµ·å¸‚: `310000`
- å¹¿ä¸œçœ: `440000`
- æµ™æ±Ÿçœ: `330000`

**ğŸ’¡ æç¤º**:
- å»ºè®®ç¼“å­˜å¸¸ç”¨åœ°åŒºçš„ç¼–ç æ˜ å°„,é¿å…é¢‘ç¹è°ƒç”¨åœ°åŒºAPI
- åœ°åŒºç¼–ç æ˜¯6ä½æ•°å­—å­—ç¬¦ä¸²
- ç›´è¾–å¸‚çš„"å¸‚è¾–åŒº"å±‚çº§æ˜¯å¿…éœ€çš„(ä¾‹å¦‚ä¸Šæµ·å¸‚éœ€è¦å…ˆé€‰å¸‚è¾–åŒº,å†é€‰å…·ä½“åŒº)
- ä½¿ç”¨ `granularity` å‚æ•°å¯ä»¥å®ç°çµæ´»çš„åœ°åŒºç»´åº¦åˆ†æ

---

#### 3.2.11 å…³è”å­—æ®µ (Relation) â­é‡ç‚¹

**å•æ¡å…³è”å†™å…¥**: ä¼ è®°å½•IDæ•°ç»„
```json
{
  "id": "related_customer",
  "value": ["945e6503-3823-4e91-9d84-a53f8bdd6fc5"]  // å®¢æˆ·è®°å½•ID
}
```

**å¤šæ¡å…³è”å†™å…¥**: ä¼ å¤šä¸ªè®°å½•ID
```json
{
  "id": "related_projects",
  "value": [
    "2df27f5e-6b8a-462c-bb6f-3de224b50bc3",
    "741c2c54-584f-49e4-9e96-01620da53e29",
    "c2e726e4-1392-4730-9c71-e5737f8503d8"
  ]
}
```

**å•æ¡å…³è”è¯»å–**: è¿”å›å¯¹è±¡æ•°ç»„
```json
{
  "related_customer": [
    {
      "sid": "945e6503-3823-4e91-9d84-a53f8bdd6fc5",
      "name": "æ˜é“äº‘ç§‘æŠ€æœ‰é™å…¬å¸"
    }
  ]
}
```

**å¤šæ¡å…³è”è¯»å–**: è¿”å›IDæ•°ç»„
```json
{
  "related_projects": [
    "2df27f5e-6b8a-462c-bb6f-3de224b50bc3",
    "741c2c54-584f-49e4-9e96-01620da53e29",
    "c2e726e4-1392-4730-9c71-e5737f8503d8"
  ]
}
```

**è·å–å…³è”è®°å½•å®Œæ•´æ•°æ®**: ä½¿ç”¨ä¸“ç”¨API
```bash
POST /v3/app/worksheets/{worksheet_id}/rows/{row_id}/relations/{field_id}

# è¿”å›å®Œæ•´å…³è”è®°å½•è¯¦æƒ…
{
  "data": {
    "rows": [
      {
        "rowid": "945e6503-3823-4e91-9d84-a53f8bdd6fc5",
        "customer_name": "æ˜é“äº‘ç§‘æŠ€æœ‰é™å…¬å¸",
        "customer_type": "æˆäº¤å®¢æˆ·",
        "annual_budget": "1000000.00"
      }
    ],
    "total": 1
  }
}
```

---

#### 3.2.12 é™„ä»¶å­—æ®µ (Attachment) â­é‡ç‚¹

**å†™å…¥**: æ”¯æŒURLå’Œbase64ä¸¤ç§æ ¼å¼
```json
{
  "id": "attachments",
  "type": "0",  // 0=è¦†ç›–å·²æœ‰é™„ä»¶, 1=è¿½åŠ æ–°é™„ä»¶
  "value": [
    {
      "name": "äº§å“å®£ä¼ å†Œ.pdf",
      "url": "https://example.com/brochure.pdf"
    },
    {
      "name": "å…¬å¸ä»‹ç».png",
      "url": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
    }
  ]
}
```

**typeå‚æ•°**:
- `"0"` - è¦†ç›–æ¨¡å¼:åˆ é™¤å·²æœ‰é™„ä»¶,ä¸Šä¼ æ–°é™„ä»¶
- `"1"` - è¿½åŠ æ¨¡å¼:ä¿ç•™å·²æœ‰é™„ä»¶,æ–°å¢é™„ä»¶

**è¯»å–**: è¿”å›é™„ä»¶å¯¹è±¡æ•°ç»„
```json
{
  "attachments": [
    {
      "file_id": "7b866bd5-8541-40b7-976f-276081bdddcd",
      "file_name": "70f9836904834c3eb44c75c587c3fcac.pdf",
      "original_file_name": "äº§å“å®£ä¼ å†Œ.pdf",
      "file_size": 2048576,
      "file_type": 4,
      "DownloadUrl": "https://p1.mingdaoyun.cn/doc/20260111/xxx.pdf",
      "preview_url": "https://...",
      "thumbnail_full_path": "https://..."
    }
  ]
}
```

**âš ï¸ é‡è¦æç¤º**:
1. é™„ä»¶ä¸Šä¼ æ˜¯**å¼‚æ­¥å¤„ç†**,é€šå¸¸éœ€è¦5-10ç§’
2. APIè¿”å›æˆåŠŸä¸ä»£è¡¨é™„ä»¶å·²ä¸Šä¼ å®Œæˆ
3. å»ºè®®ä½¿ç”¨æ˜é“äº‘å†…éƒ¨URL,å¤–éƒ¨URLå¯èƒ½æœ‰è·¨åŸŸé™åˆ¶
4. æ”¯æŒbase64ç¼–ç çš„å›¾ç‰‡ç›´æ¥ä¸Šä¼ 

---

### 3.4 å®Œæ•´åˆ›å»ºè®°å½•ç¤ºä¾‹

**åœºæ™¯**: åˆ›å»ºä¸€æ¡é”€å”®æœºä¼šè®°å½•

```json
{
  "fields": [
    {
      "id": "opportunity_name",
      "value": "æ˜é“äº‘-ä¼ä¸šç‰ˆå¹´åº¦ç»­è´¹"
    },
    {
      "id": "related_customer",
      "value": ["c74a29f0-f694-4501-9ba0-936e259daa9d"]
    },
    {
      "id": "stage",
      "value": ["a9ac7988-7603-4f03-86d5-985bd1f0cb66"]  // å•†åŠ¡è°ˆåˆ¤
    },
    {
      "id": "expected_amount",
      "value": 1200000
    },
    {
      "id": "close_date",
      "value": "2026-02-28"
    },
    {
      "id": "win_probability",
      "value": ["b9a6e559-7595-41f8-b0ad-febfb2daa4d5"]  // 90%
    },
    {
      "id": "competitor",
      "value": ""
    },
    {
      "id": "description",
      "value": "å¹´åº¦ç»­çº¦é¡¹ç›®,å¢è´­100ä¸ªè´¦æˆ·"
    }
  ],
  "triggerWorkflow": true
}
```

---

### 3.5 æ›´æ–°è®°å½• API

**API**: `POST /v3/app/worksheets/{worksheet_id}/rows/{row_id}`

**è¯·æ±‚ä½“**: ä¸åˆ›å»ºè®°å½•ç›¸åŒ
```json
{
  "fields": [
    {"id": "stage", "value": ["new-stage-key"]},
    {"id": "expected_amount", "value": 1500000}
  ],
  "triggerWorkflow": true
}
```

**âš ï¸ æ³¨æ„**:
- åªä¼ éœ€è¦æ›´æ–°çš„å­—æ®µ
- æ›´æ–°æ“ä½œä¼šè¦†ç›–åŸæœ‰å€¼(é™¤é™„ä»¶type=1è¿½åŠ æ¨¡å¼)
- å…³è”å­—æ®µæ›´æ–°ä¼šè¦†ç›–åŸæœ‰å…³è”å…³ç³»

---

### 3.6 æ‰¹é‡æ“ä½œå®Œæ•´æŒ‡å—

æ‰¹é‡æ“ä½œå¯ä»¥æ˜¾è‘—æé«˜æ•°æ®å¤„ç†æ•ˆç‡,ä½†éœ€è¦æ³¨æ„æ€§èƒ½å’Œé”™è¯¯å¤„ç†ã€‚

---

#### 3.6.1 æ‰¹é‡åˆ›å»ºè®°å½•

**API**: `POST /v3/app/worksheets/{worksheet_id}/rows/batch`

**è¯·æ±‚ä½“ç»“æ„**:
```json
{
  "rows": [
    {
      "fields": [
        {"id": "customer_name", "value": "å®¢æˆ·A"},
        {"id": "customer_type", "value": ["option-key-1"]},
        {"id": "annual_budget", "value": 500000}
      ]
    },
    {
      "fields": [
        {"id": "customer_name", "value": "å®¢æˆ·B"},
        {"id": "customer_type", "value": ["option-key-2"]},
        {"id": "annual_budget", "value": 800000}
      ]
    },
    {
      "fields": [
        {"id": "customer_name", "value": "å®¢æˆ·C"},
        {"id": "customer_type", "value": ["option-key-1"]},
        {"id": "annual_budget", "value": 1200000}
      ]
    }
  ],
  "triggerWorkflow": true
}
```

**è¿”å›ç»“æœ**:
```json
{
  "success": true,
  "error_code": 1,
  "data": {
    "successCount": 3,
    "failCount": 0,
    "rows": [
      {"row_id": "abc123..."},
      {"row_id": "def456..."},
      {"row_id": "ghi789..."}
    ]
  }
}
```

**ä½¿ç”¨åœºæ™¯**:
- âœ… åˆå§‹æ•°æ®å¯¼å…¥
- âœ… æ•°æ®è¿ç§»
- âœ… å®šæœŸæ‰¹é‡åŒæ­¥
- âœ… Excel/CSV æ•°æ®æ‰¹é‡ä¸Šä¼ 

**æ€§èƒ½å»ºè®®**:
- ğŸ“Š **å•æ¬¡æ•°é‡é™åˆ¶**: å»ºè®®æ¯æ‰¹ 50-100 æ¡è®°å½•
- ğŸ“Š **æ€»é‡è¶…è¿‡500æ¡**: åˆ†æ‰¹å¤„ç†,æ¯æ‰¹é—´éš” 1-2 ç§’
- ğŸ“Š **åŒ…å«å…³è”å­—æ®µ**: å‡å°‘åˆ°æ¯æ‰¹ 30-50 æ¡
- ğŸ“Š **åŒ…å«é™„ä»¶**: å»ºè®®å•ç‹¬å¤„ç†,ä¸è¦æ‰¹é‡

**é”™è¯¯å¤„ç†ç¤ºä¾‹**:
```javascript
async function batchCreateRecords(allData, batchSize = 100) {
  const results = [];
  const errors = [];

  // åˆ†æ‰¹å¤„ç†
  for (let i = 0; i < allData.length; i += batchSize) {
    const batch = allData.slice(i, i + batchSize);

    try {
      const response = await createBatch({
        rows: batch,
        triggerWorkflow: true
      });

      results.push(...response.data.rows);

      // è®°å½•å¤±è´¥çš„è®°å½•
      if (response.data.failCount > 0) {
        errors.push({
          batchIndex: i / batchSize,
          failCount: response.data.failCount
        });
      }

      // æ‰¹æ¬¡é—´å»¶è¿Ÿ
      if (i + batchSize < allData.length) {
        await sleep(1000);  // ç­‰å¾…1ç§’
      }

    } catch (error) {
      console.error(`Batch ${i / batchSize} failed:`, error);
      errors.push({
        batchIndex: i / batchSize,
        error: error.message
      });
    }
  }

  return { results, errors };
}
```

---

#### 3.6.2 æ‰¹é‡æ›´æ–°è®°å½•

**API**: `PUT /v3/app/worksheets/{worksheet_id}/rows/batch`

**è¯·æ±‚ä½“ç»“æ„**:
```json
{
  "rowIds": [
    "c74a29f0-f694-4501-9ba0-936e259daa9d",
    "945e6503-3823-4e91-9d84-a53f8bdd6fc5",
    "2df27f5e-6b8a-462c-bb6f-3de224b50bc3"
  ],
  "fields": [
    {
      "id": "stage",
      "value": ["new-stage-key"]
    },
    {
      "id": "rating",
      "value": "5"
    },
    {
      "id": "last_contact_date",
      "value": "2026-01-11"
    }
  ],
  "triggerWorkflow": true
}
```

**è¿”å›ç»“æœ**:
```json
{
  "success": true,
  "error_code": 1,
  "data": {
    "successCount": 3,
    "failCount": 0
  }
}
```

**âš ï¸ é‡è¦é™åˆ¶**:
1. **ç›¸åŒå€¼åº”ç”¨**: æ‰¹é‡æ›´æ–°ä¼šå°†ç›¸åŒçš„å­—æ®µå€¼åº”ç”¨åˆ°æ‰€æœ‰æŒ‡å®šè®°å½•
2. **ä¸æ”¯æŒå·®å¼‚åŒ–**: å¦‚æœéœ€è¦ä¸ºä¸åŒè®°å½•è®¾ç½®ä¸åŒå€¼,å¿…é¡»å•ç‹¬æ›´æ–°
3. **è¦†ç›–æ¨¡å¼**: æ›´æ–°æ“ä½œä¼šè¦†ç›–åŸæœ‰å€¼(é™„ä»¶ type=1 é™¤å¤–)

**ä½¿ç”¨åœºæ™¯**:
- âœ… æ‰¹é‡ä¿®æ”¹çŠ¶æ€(å¦‚:å…¨éƒ¨è®¾ä¸º"å·²å®Œæˆ")
- âœ… æ‰¹é‡åˆ†é…è´Ÿè´£äºº
- âœ… æ‰¹é‡æ›´æ–°åŒä¸€å­—æ®µ
- âŒ ä¸é€‚åˆ:ä¸ºä¸åŒè®°å½•è®¾ç½®ä¸åŒå€¼

**æ­£ç¡®ç¤ºä¾‹ - æ‰¹é‡åˆ†é…è´Ÿè´£äºº**:
```json
{
  "rowIds": ["id1", "id2", "id3"],
  "fields": [
    {
      "id": "owner",
      "value": ["user-account-id-123"]  // å°†3æ¡è®°å½•çš„è´Ÿè´£äººéƒ½æ”¹ä¸ºåŒä¸€äºº
    }
  ]
}
```

**é”™è¯¯ç¤ºä¾‹ - å°è¯•å·®å¼‚åŒ–æ›´æ–°**:
```json
// âŒ è¿™æ ·ä¸è¡Œ!æ‰¹é‡æ›´æ–°ä¸æ”¯æŒä¸ºæ¯æ¡è®°å½•è®¾ç½®ä¸åŒå€¼
{
  "rowIds": ["id1", "id2"],
  "fields": [
    {"id": "rating", "value": "5"},   // id1å’Œid2éƒ½ä¼šè¢«è®¾ä¸º5
    {"id": "rating", "value": "3"}    // åé¢çš„å€¼ä¼šè¢«å¿½ç•¥æˆ–è¦†ç›–å‰é¢çš„
  ]
}
```

**éœ€è¦å·®å¼‚åŒ–æ›´æ–°æ—¶çš„è§£å†³æ–¹æ¡ˆ**:
```javascript
// æ–¹æ¡ˆ1: å•ç‹¬æ›´æ–°æ¯æ¡è®°å½•
async function updateRecordsWithDifferentValues(updates) {
  const promises = updates.map(({rowId, fields}) =>
    updateRecord(worksheetId, rowId, { fields })
  );
  return await Promise.all(promises);
}

// ç”¨æ³•
await updateRecordsWithDifferentValues([
  { rowId: "id1", fields: [{ id: "rating", value: "5" }] },
  { rowId: "id2", fields: [{ id: "rating", value: "3" }] },
  { rowId: "id3", fields: [{ id: "rating", value: "4" }] }
]);
```

---

#### 3.6.3 æ‰¹é‡åˆ é™¤è®°å½•

**API**: `DELETE /v3/app/worksheets/{worksheet_id}/rows/batch`

**è¯·æ±‚ä½“ç»“æ„**:
```json
{
  "rowIds": [
    "c74a29f0-f694-4501-9ba0-936e259daa9d",
    "945e6503-3823-4e91-9d84-a53f8bdd6fc5"
  ],
  "permanent": false,  // false=é€»è¾‘åˆ é™¤(å¯æ¢å¤), true=ç‰©ç†åˆ é™¤(ä¸å¯æ¢å¤)
  "triggerWorkflow": true
}
```

**è¿”å›ç»“æœ**:
```json
{
  "success": true,
  "error_code": 1,
  "data": {
    "successCount": 2,
    "failCount": 0
  }
}
```

**permanent å‚æ•°è¯´æ˜**:

| å‚æ•°å€¼ | åˆ é™¤æ–¹å¼ | å¯æ¢å¤ | æ•°æ®å»å‘ | ä½¿ç”¨åœºæ™¯ |
|-------|---------|--------|---------|---------|
| `false` (é»˜è®¤) | é€»è¾‘åˆ é™¤ | âœ… å¯ä»¥ | è¿›å…¥å›æ”¶ç«™ | æ—¥å¸¸æ•°æ®æ¸…ç† |
| `true` | ç‰©ç†åˆ é™¤ | âŒ ä¸å¯æ¢å¤ | æ°¸ä¹…åˆ é™¤ | æ•æ„Ÿæ•°æ®æ¸…é™¤ |

**âš ï¸ ä¸¥é‡è­¦å‘Š**:
```javascript
// ğŸš¨ å±é™©æ“ä½œ!æ°¸ä¹…åˆ é™¤æ— æ³•æ¢å¤!
DELETE /v3/app/worksheets/{worksheet_id}/rows/batch
{
  "rowIds": ["id1", "id2"],
  "permanent": true,  // âš ï¸ æ°¸ä¹…åˆ é™¤!
  "triggerWorkflow": true
}
```

**å®‰å…¨åˆ é™¤çš„æœ€ä½³å®è·µ**:
```javascript
async function safeDeleteRecords(rowIds, options = {}) {
  const {
    permanent = false,
    confirmCallback = null,
    backupFirst = true
  } = options;

  // 1. æ°¸ä¹…åˆ é™¤éœ€è¦äºŒæ¬¡ç¡®è®¤
  if (permanent) {
    const confirmed = confirmCallback
      ? await confirmCallback(rowIds.length)
      : confirm(`ç¡®å®šè¦æ°¸ä¹…åˆ é™¤ ${rowIds.length} æ¡è®°å½•å—?æ­¤æ“ä½œä¸å¯æ¢å¤!`);

    if (!confirmed) {
      return { cancelled: true };
    }
  }

  // 2. å¯é€‰:åˆ é™¤å‰å¤‡ä»½æ•°æ®
  if (backupFirst) {
    const records = await getRecords({ rowIds });
    await saveBackup(records);  // ä¿å­˜åˆ°æœ¬åœ°æˆ–å¤‡ä»½åº“
  }

  // 3. æ‰§è¡Œåˆ é™¤
  return await deleteBatch({
    rowIds,
    permanent,
    triggerWorkflow: true
  });
}
```

**ä½¿ç”¨åœºæ™¯**:
- âœ… é€»è¾‘åˆ é™¤(`permanent: false`):
  - æ—¥å¸¸æ•°æ®æ¸…ç†
  - æµ‹è¯•æ•°æ®æ¸…ç†
  - å¯èƒ½éœ€è¦æ¢å¤çš„æ•°æ®

- âš ï¸ ç‰©ç†åˆ é™¤(`permanent: true`):
  - GDPR æ•°æ®åˆ é™¤è¦æ±‚
  - æ•æ„Ÿä¿¡æ¯å½»åº•æ¸…é™¤
  - å·²ç¡®è®¤ä¸å†éœ€è¦çš„å†å²æ•°æ®
  - **å¿…é¡»ç»è¿‡æˆæƒå®¡æ‰¹**

---

#### 3.6.4 æ‰¹é‡æ“ä½œæ€§èƒ½ä¼˜åŒ–

**æ¨èé…ç½®**:

```javascript
const BATCH_CONFIG = {
  // åŸºç¡€é…ç½®
  CREATE_BATCH_SIZE: 100,      // åˆ›å»ºæ‰¹æ¬¡å¤§å°
  UPDATE_BATCH_SIZE: 100,      // æ›´æ–°æ‰¹æ¬¡å¤§å°
  DELETE_BATCH_SIZE: 100,      // åˆ é™¤æ‰¹æ¬¡å¤§å°

  // ç‰¹æ®Šåœºæ™¯é…ç½®
  WITH_RELATION_SIZE: 50,      // åŒ…å«å…³è”å­—æ®µæ—¶
  WITH_ATTACHMENT_SIZE: 20,    // åŒ…å«é™„ä»¶æ—¶

  // å»¶è¿Ÿé…ç½®
  BATCH_DELAY: 1000,           // æ‰¹æ¬¡é—´å»¶è¿Ÿ(æ¯«ç§’)
  LARGE_BATCH_DELAY: 2000,     // å¤§æ‰¹æ¬¡å»¶è¿Ÿ(>500æ¡æ—¶)

  // é‡è¯•é…ç½®
  MAX_RETRIES: 3,              // æœ€å¤§é‡è¯•æ¬¡æ•°
  RETRY_DELAY: 3000            // é‡è¯•å»¶è¿Ÿ
};
```

**æ€§èƒ½ä¼˜åŒ–æŠ€å·§**:

1. **åŠ¨æ€è°ƒæ•´æ‰¹æ¬¡å¤§å°**:
```javascript
function calculateBatchSize(records) {
  let batchSize = BATCH_CONFIG.CREATE_BATCH_SIZE;

  // æ£€æŸ¥æ˜¯å¦åŒ…å«å…³è”å­—æ®µ
  const hasRelation = records.some(r =>
    r.fields.some(f => f.type === 'Relation')
  );
  if (hasRelation) {
    batchSize = Math.min(batchSize, BATCH_CONFIG.WITH_RELATION_SIZE);
  }

  // æ£€æŸ¥æ˜¯å¦åŒ…å«é™„ä»¶
  const hasAttachment = records.some(r =>
    r.fields.some(f => f.type === 'Attachment')
  );
  if (hasAttachment) {
    batchSize = Math.min(batchSize, BATCH_CONFIG.WITH_ATTACHMENT_SIZE);
  }

  return batchSize;
}
```

2. **å¹¶å‘æ§åˆ¶**:
```javascript
async function batchProcessWithConcurrency(items, batchSize, maxConcurrency = 3) {
  const batches = [];
  for (let i = 0; i < items.length; i += batchSize) {
    batches.push(items.slice(i, i + batchSize));
  }

  const results = [];
  for (let i = 0; i < batches.length; i += maxConcurrency) {
    const concurrentBatches = batches.slice(i, i + maxConcurrency);
    const batchResults = await Promise.all(
      concurrentBatches.map(batch => processBatch(batch))
    );
    results.push(...batchResults);

    // å¹¶å‘æ‰¹æ¬¡ä¹‹é—´ä¹Ÿè¦æœ‰å»¶è¿Ÿ
    if (i + maxConcurrency < batches.length) {
      await sleep(BATCH_CONFIG.BATCH_DELAY);
    }
  }

  return results;
}
```

3. **è¿›åº¦è¿½è¸ª**:
```javascript
async function batchCreateWithProgress(records, onProgress) {
  const batchSize = calculateBatchSize(records);
  const totalBatches = Math.ceil(records.length / batchSize);
  let processedCount = 0;

  for (let i = 0; i < totalBatches; i++) {
    const batch = records.slice(i * batchSize, (i + 1) * batchSize);

    await createBatch({ rows: batch });

    processedCount += batch.length;
    onProgress({
      current: processedCount,
      total: records.length,
      percentage: Math.round((processedCount / records.length) * 100),
      batchIndex: i + 1,
      totalBatches
    });

    if (i < totalBatches - 1) {
      await sleep(BATCH_CONFIG.BATCH_DELAY);
    }
  }
}

// ä½¿ç”¨
await batchCreateWithProgress(records, (progress) => {
  console.log(`è¿›åº¦: ${progress.percentage}% (${progress.current}/${progress.total})`);
});
```

---

#### 3.6.5 æ‰¹é‡æ“ä½œé”™è¯¯å¤„ç†

**å¸¸è§é”™è¯¯ç±»å‹**:

| é”™è¯¯ç  | è¯´æ˜ | å¤„ç†æ–¹æ¡ˆ |
|-------|------|---------|
| `10` | å‚æ•°é”™è¯¯ | æ£€æŸ¥å­—æ®µIDã€å€¼æ ¼å¼ |
| `4` | æƒé™ä¸è¶³ | æ£€æŸ¥APIæƒé™é…ç½® |
| `-1` | é€šç”¨å¤±è´¥ | æŸ¥çœ‹error_msgè¯¦æƒ… |
| `è¶…æ—¶` | è¯·æ±‚è¶…æ—¶ | å‡å°‘æ‰¹æ¬¡å¤§å°,é‡è¯• |

**å¥å£®çš„æ‰¹é‡å¤„ç†å®ç°**:
```javascript
async function robustBatchCreate(records, options = {}) {
  const {
    batchSize = 100,
    maxRetries = 3,
    onError = null,
    continueOnError = true
  } = options;

  const results = {
    success: [],
    failed: [],
    errors: []
  };

  for (let i = 0; i < records.length; i += batchSize) {
    const batch = records.slice(i, i + batchSize);
    let retries = 0;
    let success = false;

    while (retries < maxRetries && !success) {
      try {
        const response = await createBatch({ rows: batch });

        if (response.success) {
          results.success.push(...response.data.rows);
          success = true;
        } else {
          throw new Error(response.error_msg || 'Unknown error');
        }

      } catch (error) {
        retries++;

        const errorInfo = {
          batchIndex: i / batchSize,
          attempt: retries,
          error: error.message,
          records: batch
        };

        if (retries >= maxRetries) {
          // è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°
          results.failed.push(...batch);
          results.errors.push(errorInfo);

          if (onError) {
            await onError(errorInfo);
          }

          if (!continueOnError) {
            throw new Error(`Batch ${i / batchSize} failed after ${maxRetries} retries`);
          }
        } else {
          // ç­‰å¾…åé‡è¯•
          console.log(`Batch ${i / batchSize} failed, retrying (${retries}/${maxRetries})...`);
          await sleep(BATCH_CONFIG.RETRY_DELAY * retries);
        }
      }
    }

    // æ‰¹æ¬¡é—´å»¶è¿Ÿ
    if (i + batchSize < records.length) {
      await sleep(BATCH_CONFIG.BATCH_DELAY);
    }
  }

  return results;
}

// ä½¿ç”¨ç¤ºä¾‹
const result = await robustBatchCreate(records, {
  batchSize: 50,
  maxRetries: 3,
  continueOnError: true,
  onError: async (errorInfo) => {
    // è®°å½•é”™è¯¯æ—¥å¿—
    await logError(errorInfo);
    // å‘é€é€šçŸ¥
    await notifyAdmin(`æ‰¹æ¬¡ ${errorInfo.batchIndex} å¤±è´¥`);
  }
});

console.log(`æˆåŠŸ: ${result.success.length}, å¤±è´¥: ${result.failed.length}`);
if (result.failed.length > 0) {
  // å¯¼å‡ºå¤±è´¥è®°å½•
  await exportFailedRecords(result.failed);
}
```

**å¤±è´¥è®°å½•é‡è¯•ç­–ç•¥**:
```javascript
async function retryFailedRecords(failedRecords, originalBatchSize) {
  // ç­–ç•¥1: å‡å°æ‰¹æ¬¡å¤§å°
  const smallerBatchSize = Math.max(10, Math.floor(originalBatchSize / 2));

  // ç­–ç•¥2: é€æ¡é‡è¯•
  if (failedRecords.length <= 10) {
    return await retryOneByOne(failedRecords);
  }

  // ç­–ç•¥3: ä½¿ç”¨æ›´å°çš„æ‰¹æ¬¡
  return await robustBatchCreate(failedRecords, {
    batchSize: smallerBatchSize,
    maxRetries: 2
  });
}

async function retryOneByOne(records) {
  const results = { success: [], failed: [] };

  for (const record of records) {
    try {
      const response = await createRecord({ fields: record.fields });
      results.success.push(response.row_id);
    } catch (error) {
      results.failed.push({ record, error: error.message });
    }
  }

  return results;
}
```

---

#### 3.6.6 æ‰¹é‡æ“ä½œæœ€ä½³å®è·µæ€»ç»“

**âœ… æ¨èåšæ³•**:

1. **åˆç†åˆ†æ‰¹**:
   - åŸºç¡€æ•°æ®: 100æ¡/æ‰¹
   - åŒ…å«å…³è”: 50æ¡/æ‰¹
   - åŒ…å«é™„ä»¶: 20æ¡/æ‰¹,æˆ–å•ç‹¬å¤„ç†

2. **æ·»åŠ å»¶è¿Ÿ**:
   - æ‰¹æ¬¡é—´éš”: 1-2ç§’
   - å¤§é‡æ•°æ®: å¢åŠ åˆ°2-3ç§’

3. **é”™è¯¯å¤„ç†**:
   - å®ç°é‡è¯•æœºåˆ¶
   - è®°å½•å¤±è´¥æ•°æ®
   - æä¾›æ¢å¤æ–¹æ¡ˆ

4. **è¿›åº¦åé¦ˆ**:
   - æ˜¾ç¤ºå¤„ç†è¿›åº¦
   - è®°å½•å¤„ç†æ—¥å¿—
   - é€šçŸ¥å®ŒæˆçŠ¶æ€

5. **æ€§èƒ½ç›‘æ§**:
   - è®°å½•APIå“åº”æ—¶é—´
   - ç›‘æ§æˆåŠŸç‡
   - è°ƒæ•´æ‰¹æ¬¡å¤§å°

**âŒ é¿å…çš„åšæ³•**:

1. âŒ ä¸€æ¬¡æ€§æ‰¹é‡è¶…è¿‡200æ¡
2. âŒ æ‰¹é‡æ“ä½œé™„ä»¶å­—æ®µ
3. âŒ ä¸åšé”™è¯¯å¤„ç†å’Œé‡è¯•
4. âŒ æ‰¹é‡æ›´æ–°ç”¨äºå·®å¼‚åŒ–æ›´æ–°
5. âŒ ç‰©ç†åˆ é™¤(`permanent: true`)æœªç»ç¡®è®¤
6. âŒ æ— å»¶è¿Ÿè¿ç»­æ‰¹é‡è¯·æ±‚
7. âŒ å¿½ç•¥APIè¿”å›çš„error_code

---

## å››ã€æŸ¥è¯¢ç­›é€‰è§„èŒƒ

### 4.1 æŸ¥è¯¢è®°å½• API

**API**: `POST /v3/app/worksheets/{worksheet_id}/rows/list`

**åŸºæœ¬è¯·æ±‚ä½“**:
```json
{
  "filter": {},           // ç­›é€‰æ¡ä»¶,è§ä¸‹æ–‡
  "sorts": [],            // æ’åº,è§ä¸‹æ–‡
  "fields": [],           // è¿”å›å­—æ®µIDæ•°ç»„,å¯é€‰
  "search": "",           // å…³é”®è¯æœç´¢,å¯é€‰
  "pageIndex": 1,         // é¡µç 
  "pageSize": 100,        // æ¯é¡µæ•°é‡,æœ€å¤§1000
  "viewId": "",           // è§†å›¾ID,å¯é€‰
  "includeSystemFields": false,  // æ˜¯å¦è¿”å›ç³»ç»Ÿå­—æ®µ
  "useFieldIdAsKey": false       // è¿”å›æ•°æ®keyç”¨å­—æ®µIDè¿˜æ˜¯åˆ«å
}
```

---

### 4.2 Filterå¯¹è±¡ç»“æ„

**åŸºç¡€ç»“æ„**:
```typescript
Filter = {
  type: 'group' | 'condition';

  // type='group' æ—¶çš„å­—æ®µ
  logic?: 'AND' | 'OR';
  children?: Filter[];  // å­æ¡ä»¶,æœ€å¤šä¸¤å±‚åµŒå¥—

  // type='condition' æ—¶çš„å­—æ®µ
  field?: string;       // å­—æ®µIDæˆ–åˆ«å
  operator?: string;    // æ“ä½œç¬¦
  value?: any[];        // å€¼æ•°ç»„
}
```

**è§„åˆ™**:
1. é¡¶å±‚å¿…é¡»æ˜¯ `group` ç±»å‹
2. æœ€å¤šä¸¤å±‚åµŒå¥—: group â†’ group â†’ condition
3. åŒä¸€groupçš„childrenå¿…é¡»ç±»å‹ä¸€è‡´(å…¨æ˜¯groupæˆ–å…¨æ˜¯condition)
4. groupå¿…é¡»æŒ‡å®š `logic` (AND/OR)
5. conditionå¿…é¡»æŒ‡å®š `field`, `operator`
6. éƒ¨åˆ†æ“ä½œç¬¦ä¸éœ€è¦ `value` (å¦‚isempty)

---

### 4.3 æ“ä½œç¬¦å®Œæ•´åˆ—è¡¨

| æ“ä½œç¬¦ | è¯´æ˜ | éœ€è¦value | valueæ ¼å¼ | é€‚ç”¨å­—æ®µ |
|-------|------|----------|----------|---------|
| `eq` | ç­‰äº | âœ… | `["å€¼"]` | æ‰€æœ‰ç±»å‹ |
| `ne` | ä¸ç­‰äº | âœ… | `["å€¼"]` | æ‰€æœ‰ç±»å‹ |
| `contains` | åŒ…å« | âœ… | `["å€¼"]` | Text, MultipleSelect |
| `notcontains` | ä¸åŒ…å« | âœ… | `["å€¼"]` | Text, MultipleSelect |
| `startswith` | å¼€å¤´æ˜¯ | âœ… | `["å€¼"]` | Text |
| `endswith` | ç»“å°¾æ˜¯ | âœ… | `["å€¼"]` | Text |
| `gt` | å¤§äº | âœ… | `["å€¼"]` | Number, Date |
| `gte` | å¤§äºç­‰äº | âœ… | `["å€¼"]` | Number, Date |
| `lt` | å°äº | âœ… | `["å€¼"]` | Number, Date |
| `lte` | å°äºç­‰äº | âœ… | `["å€¼"]` | Number, Date |
| `between` | ä»‹äºä¹‹é—´ | âœ… | `["æœ€å°å€¼", "æœ€å¤§å€¼"]` | Number, Date |
| `isempty` | ä¸ºç©º | âŒ | ä¸éœ€è¦ | æ‰€æœ‰ç±»å‹ |
| `isnotempty` | ä¸ä¸ºç©º | âŒ | ä¸éœ€è¦ | æ‰€æœ‰ç±»å‹ |
| `belongsto` | å±äº | âœ… | `["ID1", "ID2"]` | Relation, Department |
| `in` | åœ¨...ä¸­ | âœ… | `["å€¼1", "å€¼2"]` | æ‰€æœ‰ç±»å‹ |
| `concurrent` | åŒæ—¶åŒ…å« | âœ… | `["å€¼1", "å€¼2"]` | MultipleSelect |

---

### 4.4 å„å­—æ®µç±»å‹ç­›é€‰ç¤ºä¾‹

#### 4.4.1 æ–‡æœ¬å­—æ®µç­›é€‰

**åŒ…å«æŸ¥è¯¢**:
```json
{
  "type": "group",
  "logic": "AND",
  "children": [
    {
      "type": "condition",
      "field": "customer_name",
      "operator": "contains",
      "value": ["æ˜é“"]
    }
  ]
}
```

**å¼€å¤´åŒ¹é…**:
```json
{
  "type": "condition",
  "field": "customer_name",
  "operator": "startswith",
  "value": ["åŒ—äº¬"]
}
```

---

#### 4.4.2 æ•°å€¼å­—æ®µç­›é€‰ â­é‡ç‚¹

**èŒƒå›´æŸ¥è¯¢**:
```json
{
  "type": "condition",
  "field": "annual_budget",
  "operator": "between",
  "value": ["500000", "2000000"]  // âš ï¸ å¿…é¡»æ˜¯å­—ç¬¦ä¸²æ•°ç»„
}
```

**å¤§äºæŸ¥è¯¢**:
```json
{
  "type": "condition",
  "field": "expected_amount",
  "operator": "gt",
  "value": ["1000000"]  // âš ï¸ å­—ç¬¦ä¸²æ ¼å¼
}
```

**âš ï¸ å…³é”®ç‚¹**: æ•°å€¼å­—æ®µçš„valueå¿…é¡»æ˜¯å­—ç¬¦ä¸²æ•°ç»„!

---

#### 4.4.3 å•é€‰å­—æ®µç­›é€‰ â­â­â­é‡ç‚¹

**ç­‰äºæŸ¥è¯¢** (æœ€å¸¸ç”¨):
```json
{
  "type": "condition",
  "field": "customer_type",
  "operator": "eq",
  "value": ["74c7b607-864d-4cc4-b401-28acba2636e9"]  // âš ï¸ å¿…é¡»ç”¨é€‰é¡¹key
}
```

**âŒ é”™è¯¯ç¤ºä¾‹**:
```json
{
  "type": "condition",
  "field": "customer_type",
  "operator": "eq",
  "value": ["æˆäº¤å®¢æˆ·"]  // âŒ ä¸èƒ½ç”¨æ˜¾ç¤ºæ–‡æœ¬!
}
```

**å¦‚ä½•è·å–é€‰é¡¹key**?

**æ–¹æ³•1**: å…ˆæŸ¥è¯¢ä¸€æ¡è®°å½•
```bash
POST /v3/app/worksheets/{worksheet_id}/rows/list
{
  "pageIndex": 1,
  "pageSize": 1
}

# è¿”å›æ•°æ®ä¸­åŒ…å«é€‰é¡¹key
{
  "customer_type": [
    {"key": "74c7b607-864d-4cc4-b401-28acba2636e9", "value": "æˆäº¤å®¢æˆ·"}
  ]
}
```

**æ–¹æ³•2**: æŸ¥è¯¢å·¥ä½œè¡¨ç»“æ„
```bash
GET /v3/app/worksheets/{worksheet_id}

# è¿”å›å­—æ®µå®šä¹‰,åŒ…å«optionsçš„key
{
  "fields": [
    {
      "id": "customer_type",
      "type": "SingleSelect",
      "options": [
        {"key": "74c7b607-864d-4cc4-b401-28acba2636e9", "value": "æˆäº¤å®¢æˆ·"},
        {"key": "f488d4db-5046-4b10-978f-7869c4c70a71", "value": "æ„å‘å®¢æˆ·"}
      ]
    }
  ]
}
```

**ğŸ’¡ æœ€ä½³å®è·µ**: åº”ç”¨åˆå§‹åŒ–æ—¶ç¼“å­˜æ‰€æœ‰é€‰é¡¹å­—æ®µçš„key-valueæ˜ å°„

---

#### 4.4.4 å¤šé€‰å­—æ®µç­›é€‰

**åŒ…å«æŸä¸ªé€‰é¡¹**:
```json
{
  "type": "condition",
  "field": "customer_tags",
  "operator": "contains",
  "value": ["705de83e-b929-43e4-82ff-fff2f7dd6888"]  // é‡ç‚¹å®¢æˆ·çš„key
}
```

**åŒæ—¶åŒ…å«å¤šä¸ªé€‰é¡¹**:
```json
{
  "type": "condition",
  "field": "customer_tags",
  "operator": "concurrent",
  "value": [
    "705de83e-b929-43e4-82ff-fff2f7dd6888",  // é‡ç‚¹å®¢æˆ·
    "422b4e56-263f-4bfa-bc88-77c09811080e"   // VIP
  ]
}
```

---

#### 4.4.5 æ—¥æœŸå­—æ®µç­›é€‰

**æ—¥æœŸèŒƒå›´**:
```json
{
  "type": "condition",
  "field": "founded_date",
  "operator": "between",
  "value": ["2020-01-01", "2025-12-31"]
}
```

**æ™šäºæŸæ—¥æœŸ**:
```json
{
  "type": "condition",
  "field": "close_date",
  "operator": "gte",
  "value": ["2026-01-01"]
}
```

**æ—¥æœŸæ ¼å¼**: `YYYY-MM-DD` æˆ– `YYYY-MM-DD HH:mm:ss`

---

#### 4.4.6 å…³è”å­—æ®µç­›é€‰ â­â­é‡ç‚¹

**å±äºæŸä¸ªå…³è”è®°å½•**:
```json
{
  "type": "condition",
  "field": "related_customer",
  "operator": "belongsto",  // âš ï¸ å¿…é¡»ç”¨belongsto,ä¸èƒ½ç”¨contains
  "value": ["945e6503-3823-4e91-9d84-a53f8bdd6fc5"]  // å®¢æˆ·è®°å½•ID
}
```

**å±äºå¤šä¸ªå…³è”è®°å½•ä¹‹ä¸€**:
```json
{
  "type": "condition",
  "field": "related_customer",
  "operator": "belongsto",
  "value": [
    "945e6503-3823-4e91-9d84-a53f8bdd6fc5",
    "c74a29f0-f694-4501-9ba0-936e259daa9d"
  ]
}
```

**âš ï¸ å…³é”®ç‚¹**:
1. å…³è”å­—æ®µå¿…é¡»ç”¨ `belongsto` æ“ä½œç¬¦
2. ä¸èƒ½ç”¨ `contains` æˆ– `eq`
3. valueä¼ å…¥å…³è”è®°å½•çš„rowid

---

#### 4.4.7 æˆå‘˜å­—æ®µç­›é€‰

```json
{
  "type": "condition",
  "field": "owner",
  "operator": "eq",
  "value": ["user-account-id-123"]  // ç”¨æˆ·ID,ä¸æ˜¯å§“å
}
```

---

#### 4.4.8 ç­‰çº§å­—æ®µç­›é€‰

```json
{
  "type": "condition",
  "field": "customer_rating",
  "operator": "gte",
  "value": ["4"]  // å­—ç¬¦ä¸²æ ¼å¼
}
```

---

### 4.5 ç»„åˆæ¡ä»¶ç¤ºä¾‹

#### 4.5.1 ç®€å•ANDæ¡ä»¶

**æŸ¥è¯¢**: è¯„çº§â‰¥4æ˜Ÿ ä¸” å®¢æˆ·ç±»å‹=æˆäº¤å®¢æˆ·

```json
{
  "type": "group",
  "logic": "AND",
  "children": [
    {
      "type": "condition",
      "field": "customer_rating",
      "operator": "gte",
      "value": ["4"]
    },
    {
      "type": "condition",
      "field": "customer_type",
      "operator": "eq",
      "value": ["74c7b607-864d-4cc4-b401-28acba2636e9"]
    }
  ]
}
```

---

#### 4.5.2 ç®€å•ORæ¡ä»¶

**æŸ¥è¯¢**: å®¢æˆ·ç±»å‹=æˆäº¤å®¢æˆ· æˆ– å®¢æˆ·ç±»å‹=æ„å‘å®¢æˆ·

```json
{
  "type": "group",
  "logic": "OR",
  "children": [
    {
      "type": "condition",
      "field": "customer_type",
      "operator": "eq",
      "value": ["74c7b607-864d-4cc4-b401-28acba2636e9"]  // æˆäº¤
    },
    {
      "type": "condition",
      "field": "customer_type",
      "operator": "eq",
      "value": ["f488d4db-5046-4b10-978f-7869c4c70a71"]  // æ„å‘
    }
  ]
}
```

---

#### 4.5.3 åµŒå¥—æ¡ä»¶ (AND + OR)

**æŸ¥è¯¢**: (ç±»å‹=æˆäº¤ æˆ– ç±»å‹=æ„å‘) ä¸” é¢„ç®—>50ä¸‡

```json
{
  "type": "group",
  "logic": "AND",
  "children": [
    {
      "type": "group",
      "logic": "OR",
      "children": [
        {
          "type": "condition",
          "field": "customer_type",
          "operator": "eq",
          "value": ["74c7b607-864d-4cc4-b401-28acba2636e9"]
        },
        {
          "type": "condition",
          "field": "customer_type",
          "operator": "eq",
          "value": ["f488d4db-5046-4b10-978f-7869c4c70a71"]
        }
      ]
    },
    {
      "type": "condition",
      "field": "annual_budget",
      "operator": "gt",
      "value": ["500000"]
    }
  ]
}
```

---

#### 4.5.4 å¤æ‚ä¸šåŠ¡åœºæ™¯

**æŸ¥è¯¢**: äº’è”ç½‘è¡Œä¸šçš„æˆäº¤å®¢æˆ·,ä¸”(é¢„ç®—>100ä¸‡ æˆ– è¯„çº§=5æ˜Ÿ)

```json
{
  "type": "group",
  "logic": "AND",
  "children": [
    {
      "type": "condition",
      "field": "industry",
      "operator": "eq",
      "value": ["4f28cae6-6a76-4b0b-b6e8-62cc724c677d"]  // äº’è”ç½‘
    },
    {
      "type": "condition",
      "field": "customer_type",
      "operator": "eq",
      "value": ["74c7b607-864d-4cc4-b401-28acba2636e9"]  // æˆäº¤å®¢æˆ·
    },
    {
      "type": "group",
      "logic": "OR",
      "children": [
        {
          "type": "condition",
          "field": "annual_budget",
          "operator": "gt",
          "value": ["1000000"]
        },
        {
          "type": "condition",
          "field": "customer_rating",
          "operator": "eq",
          "value": ["5"]
        }
      ]
    }
  ]
}
```

---

### 4.6 æ’åº (Sorts)

**åŸºæœ¬æ ¼å¼**:
```json
{
  "sorts": [
    {
      "field": "annual_budget",
      "isAsc": false  // false=é™åº, true=å‡åº
    },
    {
      "field": "customer_rating",
      "isAsc": false
    }
  ]
}
```

**å¤šå­—æ®µæ’åº**: æŒ‰æ•°ç»„é¡ºåºä¼˜å…ˆçº§æ’åº

---

### 4.7 å®Œæ•´æŸ¥è¯¢ç¤ºä¾‹

**ä¸šåŠ¡åœºæ™¯**: æŸ¥è¯¢äº’è”ç½‘è¡Œä¸šçš„é«˜ä»·å€¼å®¢æˆ·,æŒ‰é¢„ç®—é™åº

```json
{
  "filter": {
    "type": "group",
    "logic": "AND",
    "children": [
      {
        "type": "condition",
        "field": "industry",
        "operator": "eq",
        "value": ["4f28cae6-6a76-4b0b-b6e8-62cc724c677d"]
      },
      {
        "type": "condition",
        "field": "customer_rating",
        "operator": "gte",
        "value": ["4"]
      },
      {
        "type": "condition",
        "field": "annual_budget",
        "operator": "gt",
        "value": ["500000"]
      }
    ]
  },
  "sorts": [
    {
      "field": "annual_budget",
      "isAsc": false
    }
  ],
  "fields": ["customer_name", "customer_type", "annual_budget", "customer_rating"],
  "pageIndex": 1,
  "pageSize": 20,
  "includeSystemFields": false
}
```

---

## äº”ã€æ•°æ®é€è§†åˆ†æè§„èŒƒ

### 5.1 é€è§†åˆ†æ API

**API**: `POST /v3/app/worksheets/{worksheet_id}/rows/pivot`

**åŸºæœ¬è¯·æ±‚ä½“**:
```json
{
  "rows": [],       // è¡Œç»´åº¦
  "columns": [],    // åˆ—ç»´åº¦(å¯é€‰)
  "values": [],     // å€¼/æŒ‡æ ‡
  "filter": {},     // ç­›é€‰æ¡ä»¶(å¯é€‰)
  "sorts": [],      // æ’åº(å¯é€‰)
  "includeSummary": true,  // æ˜¯å¦åŒ…å«æ±‡æ€»
  "pageIndex": 1,
  "pageSize": 1000
}
```

---

### 5.2 ç»´åº¦é…ç½®

**è¡Œ/åˆ—ç»´åº¦ç»“æ„**:
```json
{
  "field": "industry",          // å­—æ®µIDæˆ–åˆ«å
  "displayName": "æ‰€å±è¡Œä¸š",    // æ˜¾ç¤ºåç§°(å¯é€‰)
  "granularity": 1,             // ç²’åº¦(æ—¥æœŸ/åœ°åŒºå­—æ®µ)
  "includeEmpty": false         // æ˜¯å¦åŒ…å«ç©ºå€¼
}
```

**granularityå‚æ•°** (ä»…æ—¥æœŸå’Œåœ°åŒºå­—æ®µ):

**æ—¥æœŸå­—æ®µ**:
- `1` - æŒ‰å¤©
- `2` - æŒ‰å‘¨
- `3` - æŒ‰æœˆ

**åœ°åŒºå­—æ®µ**:
- `1` - çœ
- `2` - çœ/å¸‚
- `3` - çœ/å¸‚/åŒºå¿

---

### 5.3 å€¼/æŒ‡æ ‡é…ç½®

**å€¼é…ç½®ç»“æ„**:
```json
{
  "field": "annual_budget",     // å­—æ®µIDæˆ–åˆ«å
  "aggregation": "SUM",         // èšåˆå‡½æ•°
  "displayName": "é¢„ç®—æ€»é¢",    // æ˜¾ç¤ºåç§°(å¯é€‰)
  "includeEmpty": false         // æ˜¯å¦åŒ…å«ç©ºå€¼
}
```

**èšåˆå‡½æ•°** (ä¸åŒºåˆ†å¤§å°å†™):

| å‡½æ•° | è¯´æ˜ | é€‚ç”¨å­—æ®µ |
|-----|------|---------|
| `COUNT` | è®¡æ•° | æ‰€æœ‰å­—æ®µ |
| `DISTINCTCOUNT` | å»é‡è®¡æ•° | æ‰€æœ‰å­—æ®µ |
| `SUM` | æ±‚å’Œ | Number |
| `AVG` | å¹³å‡å€¼ | Number |
| `MIN` | æœ€å°å€¼ | Number, Date |
| `MAX` | æœ€å¤§å€¼ | Number, Date |

**âš ï¸ æ³¨æ„**:
- ç»Ÿè®¡è¡Œæ•°æ—¶,`field` ä½¿ç”¨ `"rowid"`
- `aggregation` ä¸åŒºåˆ†å¤§å°å†™

---

### 5.4 é€è§†åˆ†æç¤ºä¾‹

#### 5.4.1 å•ç»´åº¦ç»Ÿè®¡

**åœºæ™¯**: æŒ‰è¡Œä¸šç»Ÿè®¡å®¢æˆ·æ•°é‡å’Œé¢„ç®—æ€»é¢

```json
{
  "rows": [
    {
      "field": "industry",
      "displayName": "æ‰€å±è¡Œä¸š",
      "includeEmpty": false
    }
  ],
  "values": [
    {
      "field": "rowid",
      "aggregation": "COUNT",
      "displayName": "å®¢æˆ·æ•°é‡"
    },
    {
      "field": "annual_budget",
      "aggregation": "SUM",
      "displayName": "é¢„ç®—æ€»é¢"
    }
  ],
  "includeSummary": true,
  "pageIndex": 1,
  "pageSize": 50
}
```

**è¿”å›ç»“æœ**:
```json
{
  "data": {
    "pivot": [
      {
        "rows": {"industry": "äº’è”ç½‘"},
        "values": {"rowid": 4.0, "annual_budget": 2150000.0}
      },
      {
        "rows": {"industry": "é‡‘è"},
        "values": {"rowid": 1.0, "annual_budget": 2000000.0}
      }
    ],
    "summary": {
      "rowid": 12.0,
      "annual_budget": 7900000.0
    }
  }
}
```

---

#### 5.4.2 å¤šæŒ‡æ ‡ç»Ÿè®¡

**åœºæ™¯**: æŒ‰é”€å”®é˜¶æ®µç»Ÿè®¡æœºä¼šçš„æ•°é‡ã€é‡‘é¢æ€»è®¡ã€å¹³å‡é‡‘é¢

```json
{
  "rows": [
    {
      "field": "opportunity_stage",
      "displayName": "é”€å”®é˜¶æ®µ"
    }
  ],
  "values": [
    {
      "field": "rowid",
      "aggregation": "COUNT",
      "displayName": "æœºä¼šæ•°é‡"
    },
    {
      "field": "expected_amount",
      "aggregation": "SUM",
      "displayName": "é‡‘é¢æ€»è®¡"
    },
    {
      "field": "expected_amount",
      "aggregation": "AVG",
      "displayName": "å¹³å‡é‡‘é¢"
    }
  ],
  "includeSummary": true
}
```

**è¿”å›ç»“æœ**:
```json
{
  "data": {
    "pivot": [
      {
        "rows": {"opportunity_stage": "å•†åŠ¡è°ˆåˆ¤"},
        "values": {
          "rowid": 3.0,
          "expected_amount": 2710000.0,
          "expected_amount_avg": 903333.33
        }
      }
    ],
    "summary": {
      "rowid": 10.0,
      "expected_amount": 8990000.0,
      "expected_amount_avg": 899000.0
    }
  }
}
```

---

#### 5.4.3 å¤šç»´åº¦äº¤å‰åˆ†æ

**åœºæ™¯**: æŒ‰å®¢æˆ·ç±»å‹å’Œè¡Œä¸šäº¤å‰ç»Ÿè®¡å®¢æˆ·æ•°

```json
{
  "rows": [
    {
      "field": "customer_type",
      "displayName": "å®¢æˆ·ç±»å‹"
    },
    {
      "field": "industry",
      "displayName": "æ‰€å±è¡Œä¸š"
    }
  ],
  "values": [
    {
      "field": "rowid",
      "aggregation": "COUNT",
      "displayName": "å®¢æˆ·æ•°"
    }
  ],
  "includeSummary": true
}
```

**è¿”å›ç»“æœ**: äºŒç»´äº¤å‰æ•°æ®
```json
{
  "data": {
    "pivot": [
      {
        "rows": {
          "customer_type": "æˆäº¤å®¢æˆ·",
          "industry": "äº’è”ç½‘"
        },
        "values": {"rowid": 3.0}
      },
      {
        "rows": {
          "customer_type": "æ„å‘å®¢æˆ·",
          "industry": "åˆ¶é€ ä¸š"
        },
        "values": {"rowid": 2.0}
      }
    ],
    "summary": {"rowid": 12.0}
  }
}
```

---

#### 5.4.4 å¸¦ç­›é€‰çš„é€è§†åˆ†æ

**åœºæ™¯**: ç»Ÿè®¡2026å¹´Q1é¢„è®¡æˆäº¤çš„æœºä¼š

```json
{
  "filter": {
    "type": "group",
    "logic": "AND",
    "children": [
      {
        "type": "condition",
        "field": "expected_close_date",
        "operator": "between",
        "value": ["2026-01-01", "2026-03-31"]
      }
    ]
  },
  "rows": [
    {
      "field": "opportunity_stage",
      "displayName": "é”€å”®é˜¶æ®µ"
    }
  ],
  "values": [
    {
      "field": "rowid",
      "aggregation": "COUNT",
      "displayName": "æœºä¼šæ•°é‡"
    },
    {
      "field": "expected_amount",
      "aggregation": "SUM",
      "displayName": "é‡‘é¢æ€»è®¡"
    }
  ],
  "includeSummary": true
}
```

---

## å…­ã€å…³è”å­—æ®µå®Œæ•´æŒ‡å—

### 6.1 å…³è”å­—æ®µè®¾è®¡åŸåˆ™

**åˆ›å»ºå…³è”å­—æ®µå‰éœ€è€ƒè™‘**:
1. å…³è”æ–¹å‘:å•å‘è¿˜æ˜¯åŒå‘?
2. å…³è”æ•°é‡:å•æ¡è¿˜æ˜¯å¤šæ¡?
3. æ˜¾ç¤ºå­—æ®µ:å…³è”å¡ç‰‡æ˜¾ç¤ºå“ªäº›ä¿¡æ¯?
4. æ•°æ®ä¾èµ–:ç›®æ ‡è¡¨å¿…é¡»å…ˆå­˜åœ¨

---

### 6.2 å…³è”å­—æ®µåˆ›å»ºæ­¥éª¤

**Step 1**: åˆ›å»ºç›®æ ‡å·¥ä½œè¡¨(å¦‚å®¢æˆ·è¡¨)
```json
{
  "name": "å®¢æˆ·ä¿¡æ¯è¡¨",
  "fields": [
    {"name": "å®¢æˆ·åç§°", "type": "Text", "isTitle": true},
    {"name": "å®¢æˆ·ç±»å‹", "type": "SingleSelect", "options": [...]}
  ]
}

// è¿”å›: {"worksheet_id": "696367c3b86aebd924a164f0"}
```

**Step 2**: åœ¨æºå·¥ä½œè¡¨åˆ›å»ºå…³è”å­—æ®µ(å¦‚æœºä¼šè¡¨)
```json
{
  "name": "é”€å”®æœºä¼šè¡¨",
  "fields": [
    {"name": "æœºä¼šåç§°", "type": "Text", "isTitle": true},
    {
      "name": "å…³è”å®¢æˆ·",
      "alias": "related_customer",
      "type": "Relation",
      "subType": "1",  // å•æ¡å…³è”
      "dataSource": "696367c3b86aebd924a164f0",  // å®¢æˆ·è¡¨ID
      "relation": {
        "bidirectional": false,
        "showFields": ["customer_name", "customer_type"]
      }
    }
  ]
}
```

---

### 6.3 å•å‘ vs åŒå‘å…³è”

**å•å‘å…³è”** (`bidirectional: false`):
- åªåœ¨æºè¡¨åˆ›å»ºå…³è”å­—æ®µ
- ç›®æ ‡è¡¨ä¸ä¼šè‡ªåŠ¨åˆ›å»ºåå‘å­—æ®µ
- é€‚ç”¨åœºæ™¯:æœºä¼šâ†’å®¢æˆ·,ä»»åŠ¡â†’é¡¹ç›®

**åŒå‘å…³è”** (`bidirectional: true`):
- æºè¡¨å’Œç›®æ ‡è¡¨éƒ½æœ‰å…³è”å­—æ®µ
- ç³»ç»Ÿè‡ªåŠ¨åœ¨ç›®æ ‡è¡¨åˆ›å»ºåå‘å­—æ®µ
- é€‚ç”¨åœºæ™¯:å®¢æˆ·â†”è”ç³»äºº,é¡¹ç›®â†”ä»»åŠ¡

**ç¤ºä¾‹ - åŒå‘å…³è”**:
```json
{
  "name": "å…³è”é¡¹ç›®",
  "type": "Relation",
  "subType": "2",  // å¤šæ¡å…³è”
  "dataSource": "project-table-id",
  "relation": {
    "bidirectional": true,  // åŒå‘
    "showFields": ["project_name", "project_status"]
  }
}
```

**æ•ˆæœ**:
- è”ç³»äººè¡¨:æ˜¾ç¤º"å…³è”é¡¹ç›®"å­—æ®µ
- é¡¹ç›®è¡¨:è‡ªåŠ¨åˆ›å»º"å…³è”è”ç³»äºº"åå‘å­—æ®µ

---

### 6.4 å…³è”å­—æ®µå†™å…¥å®Œæ•´æµç¨‹

**åœºæ™¯**: ä¸ºé”€å”®æœºä¼šå…³è”å®¢æˆ·

**Step 1**: æŸ¥è¯¢å®¢æˆ·è®°å½•,è·å–rowid
```bash
POST /v3/app/worksheets/696367c3b86aebd924a164f0/rows/list
{
  "filter": {
    "type": "group",
    "logic": "AND",
    "children": [
      {
        "type": "condition",
        "field": "customer_name",
        "operator": "contains",
        "value": ["æ˜é“äº‘"]
      }
    ]
  },
  "pageSize": 1
}

# è¿”å›
{
  "data": {
    "rows": [
      {"rowid": "c74a29f0-f694-4501-9ba0-936e259daa9d", ...}
    ]
  }
}
```

**Step 2**: åˆ›å»ºæœºä¼šè®°å½•,ä¼ å…¥å®¢æˆ·rowid
```bash
POST /v3/app/worksheets/696367eec91f18e9b9f391a1/rows
{
  "fields": [
    {
      "id": "opportunity_name",
      "value": "æ˜é“äº‘-å¹´åº¦ç»­è´¹"
    },
    {
      "id": "related_customer",
      "value": ["c74a29f0-f694-4501-9ba0-936e259daa9d"]  // å®¢æˆ·rowid
    }
  ]
}
```

**Step 3**: è¯»å–éªŒè¯
```bash
GET /v3/app/worksheets/696367eec91f18e9b9f391a1/rows/{row_id}

# è¿”å›
{
  "related_customer": [
    {
      "sid": "c74a29f0-f694-4501-9ba0-936e259daa9d",
      "name": "æ˜é“äº‘ç§‘æŠ€æœ‰é™å…¬å¸"
    }
  ]
}
```

---

### 6.5 è·å–å…³è”è®°å½•å®Œæ•´æ•°æ®

#### 6.5.1 å…³è”å­—æ®µè¿”å›çš„æ•°æ®ç»“æ„

å½“è¯»å–åŒ…å«å…³è”å­—æ®µçš„è®°å½•æ—¶,HAP API è¿”å›çš„æ•°æ®ç»“æ„å¦‚ä¸‹:

```javascript
{
  "6963afe3c62174e0baa77a3d": [  // å…³è”å­—æ®µID
    {
      "sid": "9dd9272b-e7e5-40d5-8a6d-d2403d1e45c2",  // å…³è”è®°å½•çš„ID (ç­‰åŒäº rowid)
      "name": "å®æœ¨è¡£æŸœ"  // å…³è”è®°å½•çš„æ ‡é¢˜å­—æ®µå€¼
    }
  ]
}
```

**å…³é”®å±æ€§è¯´æ˜**:
- **`sid`**: å…³è”è®°å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦,ç­‰åŒäºç›®æ ‡è¡¨ä¸­çš„ `rowid`
- **`name`**: å…³è”è®°å½•çš„æ ‡é¢˜å­—æ®µå€¼(ä»…æ˜¾ç¤ºç”¨é€”)

**âš ï¸ é‡è¦æç¤º**:
- é»˜è®¤æƒ…å†µä¸‹,å…³è”å­—æ®µåªè¿”å› `sid` å’Œ `name` ä¸¤ä¸ªå±æ€§
- å¦‚æœéœ€è¦å±•ç¤ºå…³è”è¡¨çš„å…¶ä»–ä¿¡æ¯(å¦‚å›¾ç‰‡ã€ä»·æ ¼ã€æè¿°ç­‰),éœ€è¦è¿›è¡Œ**æ·±åº¦æŸ¥è¯¢**
- æ·±åº¦æŸ¥è¯¢æ­¥éª¤:
  1. æ‰¾åˆ°è¯¥å…³è”å­—æ®µå¯¹åº”çš„ç›®æ ‡å·¥ä½œè¡¨ ID
  2. ä½¿ç”¨ `sid` (ç­‰åŒäº `rowid`) å»ç›®æ ‡è¡¨æŸ¥è¯¢å®Œæ•´æ•°æ®

---

#### 6.5.2 æ–¹æ³•1: ä½¿ç”¨ get_record_relations API (æ¨è)

**é€‚ç”¨åœºæ™¯**: è·å–å•æ¡è®°å½•çš„å…³è”è¯¦æƒ…

```bash
POST /v3/app/worksheets/{worksheet_id}/rows/{row_id}/relations/{field_id}
{
  "pageIndex": 1,
  "pageSize": 10,
  "isReturnSystemFields": false
}

# è¿”å›å®Œæ•´å…³è”è®°å½•è¯¦æƒ…
{
  "data": {
    "rows": [
      {
        "rowid": "c74a29f0-f694-4501-9ba0-936e259daa9d",
        "customer_name": "æ˜é“äº‘ç§‘æŠ€æœ‰é™å…¬å¸",
        "customer_type": [{"key": "...", "value": "æˆäº¤å®¢æˆ·"}],
        "annual_budget": "1000000.00",
        "customer_rating": "5"
      }
    ],
    "total": 1
  }
}
```

**ä¼˜ç‚¹**: ä¸€æ¬¡è¯·æ±‚è·å–å®Œæ•´æ•°æ®,æ— éœ€æ‰‹åŠ¨æŸ¥è¯¢ç›®æ ‡è¡¨

---

#### 6.5.3 æ–¹æ³•2: å…ˆè¯»å–å…³è”ID,å†æŸ¥è¯¢ç›®æ ‡è¡¨

**é€‚ç”¨åœºæ™¯**: æ‰¹é‡æŸ¥è¯¢å¤šæ¡è®°å½•çš„å…³è”è¯¦æƒ…(é¿å… N+1 æŸ¥è¯¢é—®é¢˜)

**Step 1**: è¯»å–åŒ…å«å…³è”å­—æ®µçš„è®°å½•
```bash
GET /v3/app/worksheets/696367eec91f18e9b9f391a1/rows/{row_id}

# è¿”å›
{
  "related_customer": [
    {
      "sid": "c74a29f0-f694-4501-9ba0-936e259daa9d",
      "name": "æ˜é“äº‘ç§‘æŠ€æœ‰é™å…¬å¸"
    }
  ]
}
```

**Step 2**: ä½¿ç”¨ `sid` æŸ¥è¯¢ç›®æ ‡è¡¨å®Œæ•´æ•°æ®

âš ï¸ **å…³é”®**: ä½¿ç”¨ `rowid` å­—æ®µ + `in` æ“ä½œç¬¦è¿›è¡ŒæŸ¥è¯¢

```bash
POST /v3/app/worksheets/696367c3b86aebd924a164f0/rows/list
{
  "filter": {
    "type": "group",
    "logic": "AND",
    "children": [
      {
        "type": "condition",
        "field": "rowid",  // âš ï¸ ä½¿ç”¨ç³»ç»Ÿå­—æ®µ rowid
        "operator": "in",  // âš ï¸ ä½¿ç”¨ in æ“ä½œç¬¦
        "value": ["c74a29f0-f694-4501-9ba0-936e259daa9d"]  // ä¼ å…¥ sid å€¼
      }
    ]
  }
}

# è¿”å›å®Œæ•´æ•°æ®
{
  "data": {
    "rows": [
      {
        "rowid": "c74a29f0-f694-4501-9ba0-936e259daa9d",
        "customer_name": "æ˜é“äº‘ç§‘æŠ€æœ‰é™å…¬å¸",
        "customer_type": [{"key": "...", "value": "æˆäº¤å®¢æˆ·"}],
        "customer_logo": [{"downloadUrl": "https://..."}],
        "annual_budget": "1000000.00",
        "customer_rating": "5",
        "customer_address": "ä¸Šæµ·å¸‚å¾æ±‡åŒº"
      }
    ]
  }
}
```

---

#### 6.5.4 æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–ç¤ºä¾‹

**åœºæ™¯**: äº§å“åˆ—è¡¨é¡µé¢,éœ€è¦æ˜¾ç¤ºæ¯ä¸ªäº§å“çš„å®Œæ•´åˆ†ç±»ä¿¡æ¯(åŒ…æ‹¬åˆ†ç±»å›¾æ ‡ã€æè¿°ç­‰)

**é—®é¢˜**: å¦‚æœæœ‰ 100 ä¸ªäº§å“,é€ä¸ªæŸ¥è¯¢åˆ†ç±»ä¼šäº§ç”Ÿ N+1 æŸ¥è¯¢é—®é¢˜(1æ¬¡äº§å“æŸ¥è¯¢ + Næ¬¡åˆ†ç±»æŸ¥è¯¢)

**è§£å†³æ–¹æ¡ˆ**: æ‰¹é‡æ”¶é›†æ‰€æœ‰åˆ†ç±» ID,ä¸€æ¬¡æ€§æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»

```javascript
// Step 1: è·å–äº§å“åˆ—è¡¨
const products = await getRows('products-worksheet-id', {
  pageSize: 100
});

// Step 2: æ”¶é›†æ‰€æœ‰äº§å“çš„åˆ†ç±» ID (ä½¿ç”¨ Set è‡ªåŠ¨å»é‡)
const categoryIds = new Set();
products.rows.forEach(product => {
  const categories = product['category_field_id'];  // å…³è”å­—æ®µ
  if (Array.isArray(categories)) {
    categories.forEach(cat => {
      categoryIds.add(cat.sid);  // æ”¶é›† sid
    });
  }
});

// Step 3: æ‰¹é‡æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»çš„å®Œæ•´æ•°æ® (1æ¬¡è¯·æ±‚!)
const categoriesData = await getRows('categories-worksheet-id', {
  filter: {
    type: 'group',
    logic: 'AND',
    children: [{
      type: 'condition',
      field: 'rowid',
      operator: 'in',
      value: Array.from(categoryIds)  // ä¼ å…¥æ‰€æœ‰ sid æ•°ç»„
    }]
  }
});

// Step 4: å»ºç«‹åˆ†ç±» ID â†’ åˆ†ç±»æ•°æ®çš„æ˜ å°„ (O(1) æŸ¥æ‰¾)
const categoryMap = {};
categoriesData.rows.forEach(cat => {
  categoryMap[cat.rowid] = cat;
});

// Step 5: æ¸²æŸ“äº§å“åˆ—è¡¨,ç›´æ¥ä» map ä¸­å–åˆ†ç±»æ•°æ®
products.rows.forEach(product => {
  const categories = product['category_field_id'];
  const categoryData = categoryMap[categories[0].sid];

  console.log({
    productName: product.name,
    categoryName: categoryData.name,
    categoryIcon: categoryData.icon[0].downloadUrl,
    categoryDesc: categoryData.description
  });
});
```

**æ€§èƒ½å¯¹æ¯”**:
- âŒ é€ä¸ªæŸ¥è¯¢: 1 + 100 = 101 æ¬¡ API è¯·æ±‚
- âœ… æ‰¹é‡æŸ¥è¯¢: 1 + 1 = 2 æ¬¡ API è¯·æ±‚ (æ€§èƒ½æå‡ 50 å€!)

---

#### 6.5.5 æ–¹æ³•é€‰æ‹©å»ºè®®

| åœºæ™¯ | æ¨èæ–¹æ³• | åŸå›  |
|------|---------|------|
| å•æ¡è®°å½•è¯¦æƒ…é¡µ | æ–¹æ³•1 (get_record_relations) | ç®€å•ç›´æ¥,ä¸€æ¬¡è¯·æ±‚ |
| åˆ—è¡¨é¡µæ‰¹é‡æ¸²æŸ“ | æ–¹æ³•2 (æ‰¹é‡æŸ¥è¯¢) | é¿å… N+1 æŸ¥è¯¢,æ€§èƒ½æœ€ä¼˜ |
| éœ€è¦è‡ªå®šä¹‰ç­›é€‰æ¡ä»¶ | æ–¹æ³•2 | å¯ä»¥åœ¨æŸ¥è¯¢ç›®æ ‡è¡¨æ—¶æ·»åŠ é¢å¤–ç­›é€‰ |
| åªéœ€è¦æ˜¾ç¤º name | ç›´æ¥ä½¿ç”¨ | æ— éœ€é¢å¤–æŸ¥è¯¢ |

---

### 6.6 å…³è”å­—æ®µæ›´æ–°

**è¦†ç›–å…³è”**:
```json
{
  "fields": [
    {
      "id": "related_customer",
      "value": ["new-customer-id"]  // è¦†ç›–åŸæœ‰å…³è”
    }
  ]
}
```

**æ¸…ç©ºå…³è”**:
```json
{
  "fields": [
    {
      "id": "related_customer",
      "value": []  // ç©ºæ•°ç»„=æ¸…ç©ºå…³è”
    }
  ]
}
```

**å¤šæ¡å…³è”è¿½åŠ **: éœ€è¦å…ˆè¯»å–åŸæœ‰ID,å†åˆå¹¶
```bash
# Step 1: è¯»å–åŸæœ‰å…³è”
GET /v3/app/worksheets/{worksheet_id}/rows/{row_id}
# è¿”å›: {"related_projects": ["id1", "id2"]}

# Step 2: åˆå¹¶æ–°IDå¹¶æ›´æ–°
POST /v3/app/worksheets/{worksheet_id}/rows/{row_id}
{
  "fields": [
    {
      "id": "related_projects",
      "value": ["id1", "id2", "id3"]  // åŸæœ‰+æ–°å¢
    }
  ]
}
```

---

### 6.7 å…³è”å­—æ®µå¸¸è§é—®é¢˜

**Q1: å…³è”å­—æ®µè¿”å›çš„ `sid` å’Œ `name` æœ‰ä»€ä¹ˆåŒºåˆ«?**

- **`sid`**: å…³è”è®°å½•çš„å”¯ä¸€æ ‡è¯†ç¬¦,ç­‰åŒäºç›®æ ‡è¡¨çš„ `rowid`,ç”¨äºæŸ¥è¯¢å®Œæ•´æ•°æ®
- **`name`**: å…³è”è®°å½•çš„æ ‡é¢˜å­—æ®µå€¼,ä»…ç”¨äºæ˜¾ç¤º

**å…³é”®ç†è§£**:
```javascript
// è¯»å–äº§å“è®°å½•
{
  "category_field": [
    {
      "sid": "9dd9272b-e7e5-40d5-8a6d-d2403d1e45c2",  // ç”¨äºæŸ¥è¯¢
      "name": "å®æœ¨è¡£æŸœ"  // ç”¨äºæ˜¾ç¤º
    }
  ]
}

// å¦‚æœéœ€è¦è·å–åˆ†ç±»çš„å›¾æ ‡ã€æè¿°ç­‰å…¶ä»–ä¿¡æ¯,å¿…é¡»ä½¿ç”¨ sid æŸ¥è¯¢
// sid === ç›®æ ‡è¡¨ä¸­çš„ rowid
```

**ä½¿ç”¨åœºæ™¯**:
- åªéœ€è¦æ˜¾ç¤ºåç§° â†’ ç›´æ¥ä½¿ç”¨ `name`
- éœ€è¦æ˜¾ç¤ºå…¶ä»–å­—æ®µ(å›¾ç‰‡ã€ä»·æ ¼ã€æè¿°ç­‰) â†’ ä½¿ç”¨ `sid` æŸ¥è¯¢ç›®æ ‡è¡¨

---

**Q2: å…³è”å­—æ®µåˆ›å»ºåèƒ½ä¿®æ”¹dataSourceå—?**

âŒ ä¸èƒ½ã€‚dataSourceä¸€æ—¦è®¾ç½®ä¸å¯ä¿®æ”¹,åªèƒ½åˆ é™¤å­—æ®µé‡å»ºã€‚

---

**Q3: å¦‚ä½•å®ç°çº§è”åˆ é™¤?**

é€šè¿‡å·¥ä½œæµå®ç°ã€‚å½“æºè®°å½•åˆ é™¤æ—¶,è§¦å‘å·¥ä½œæµåˆ é™¤å…³è”è®°å½•ã€‚

---

**Q4: å…³è”å­—æ®µèƒ½è·¨åº”ç”¨å—?**

âœ… å¯ä»¥ã€‚åªè¦æœ‰ç›®æ ‡å·¥ä½œè¡¨çš„ID,å³ä½¿åœ¨ä¸åŒåº”ç”¨ä¹Ÿèƒ½å…³è”ã€‚

---

**Q5: åŒå‘å…³è”çš„åå‘å­—æ®µåç§°å¯ä»¥è‡ªå®šä¹‰å—?**

âŒ ä¸èƒ½ã€‚ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ,æ ¼å¼ä¸º"å…³è”{æºè¡¨å}"ã€‚

---

**Q6: å…³è”è®°å½•è¢«åˆ é™¤å,å…³è”å­—æ®µä¼šæ€æ ·?**

å…³è”å­—æ®µä¼šè‡ªåŠ¨æ¸…ç©ºè¯¥å…³è”å…³ç³»,ä¸ä¼šæŠ¥é”™ã€‚

---

**Q7: ä¸ºä»€ä¹ˆæŸ¥è¯¢å…³è”è®°å½•è¦ç”¨ `rowid` å­—æ®µè€Œä¸æ˜¯å…¶ä»–å­—æ®µ?**

å› ä¸º `rowid` æ˜¯ HAP ç³»ç»Ÿå­—æ®µ,æ¯æ¡è®°å½•éƒ½æœ‰å”¯ä¸€çš„ `rowid`ã€‚å…³è”å­—æ®µè¿”å›çš„ `sid` å°±æ˜¯ç›®æ ‡è®°å½•çš„ `rowid`ã€‚

**ç¤ºä¾‹**:
```javascript
// å…³è”å­—æ®µè¿”å›çš„ sid
const categoryId = product.category[0].sid;  // "9dd9272b-..."

// æŸ¥è¯¢ç›®æ ‡è¡¨æ—¶,ä½¿ç”¨ rowid å­—æ®µåŒ¹é…
{
  "filter": {
    "type": "condition",
    "field": "rowid",  // å¿…é¡»ç”¨ rowid
    "operator": "in",
    "value": [categoryId]  // ä¼ å…¥ sid
  }
}
```

---

## ä¸ƒã€å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ

### 7.1 é€‰é¡¹å­—æ®µé™·é˜± â­â­â­

**é—®é¢˜**: ç­›é€‰å•é€‰/å¤šé€‰å­—æ®µæ—¶è¿”å›ç©ºç»“æœ

**é”™è¯¯ç¤ºä¾‹**:
```json
{
  "field": "customer_type",
  "operator": "eq",
  "value": ["æˆäº¤å®¢æˆ·"]  // âŒ ä½¿ç”¨äº†æ˜¾ç¤ºæ–‡æœ¬
}
```

**æ­£ç¡®åšæ³•**:
```json
{
  "field": "customer_type",
  "operator": "eq",
  "value": ["74c7b607-864d-4cc4-b401-28acba2636e9"]  // âœ… ä½¿ç”¨é€‰é¡¹key
}
```

**è§£å†³æ–¹æ¡ˆ**:
1. åˆå§‹åŒ–æ—¶æŸ¥è¯¢å·¥ä½œè¡¨ç»“æ„,ç¼“å­˜é€‰é¡¹æ˜ å°„
2. æˆ–å…ˆæŸ¥è¯¢ä¸€æ¡è®°å½•,ä»è¿”å›æ•°æ®è·å–key
3. å»ºç«‹ value â†’ key çš„æ˜ å°„è¡¨

---

### 7.2 æ•°å€¼å­—æ®µé™·é˜±

**é—®é¢˜**: æ•°å€¼ç­›é€‰æ— ç»“æœæˆ–æŠ¥é”™

**é”™è¯¯ç¤ºä¾‹**:
```json
{
  "field": "annual_budget",
  "operator": "gt",
  "value": [1000000]  // âŒ æ•°å­—ç±»å‹
}
```

**æ­£ç¡®åšæ³•**:
```json
{
  "field": "annual_budget",
  "operator": "gt",
  "value": ["1000000"]  // âœ… å­—ç¬¦ä¸²æ•°ç»„
}
```

**è®°å¿†å£è¯€**: ç­›é€‰æ¡ä»¶çš„valueæ°¸è¿œæ˜¯å­—ç¬¦ä¸²æ•°ç»„

---

### 7.3 å…³è”å­—æ®µé™·é˜± â­â­â­

**é—®é¢˜1**: ä½¿ç”¨é”™è¯¯çš„æ“ä½œç¬¦ç­›é€‰å…³è”å­—æ®µ

**é”™è¯¯ç¤ºä¾‹**:
```json
{
  "field": "related_customer",
  "operator": "eq",  // âŒ å…³è”å­—æ®µä¸æ”¯æŒ eq
  "value": ["customer-id"]
}
```

**æ­£ç¡®åšæ³•**:
```json
{
  "field": "related_customer",
  "operator": "contains",  // âœ… ä½¿ç”¨ contains æˆ– belongsto
  "value": ["customer-id"]  // ä¼ å…¥å…³è”è®°å½•çš„ sid (ç­‰åŒäº rowid)
}
```

**å…³è”å­—æ®µæ”¯æŒçš„æ“ä½œç¬¦**:
- `contains`: åŒ…å«æŒ‡å®šå…³è”è®°å½•
- `notcontains`: ä¸åŒ…å«æŒ‡å®šå…³è”è®°å½•
- `isempty`: å…³è”å­—æ®µä¸ºç©º
- `isnotempty`: å…³è”å­—æ®µä¸ä¸ºç©º

---

**é—®é¢˜2**: æ··æ·† `sid` å’Œå­—æ®µå

**é”™è¯¯ç¤ºä¾‹**:
```javascript
// é”™è¯¯:å°è¯•ä»å…³è”å­—æ®µç›´æ¥è·å–ç›®æ ‡è¡¨çš„å…¶ä»–å­—æ®µ
const categoryIcon = product.category[0].icon;  // âŒ undefined!
```

**æ­£ç¡®ç†è§£**:
```javascript
// å…³è”å­—æ®µåªè¿”å› sid å’Œ name
const category = product.category[0];
console.log(category);
// {
//   "sid": "9dd9272b-...",  // å…³è”è®°å½•ID
//   "name": "å®æœ¨è¡£æŸœ"      // æ ‡é¢˜å­—æ®µå€¼
// }

// å¦‚æœéœ€è¦ icon ç­‰å…¶ä»–å­—æ®µ,å¿…é¡»æŸ¥è¯¢ç›®æ ‡è¡¨
const categoryData = await getRows('category-worksheet-id', {
  filter: {
    type: 'condition',
    field: 'rowid',
    operator: 'in',
    value: [category.sid]  // ä½¿ç”¨ sid æŸ¥è¯¢
  }
});

console.log(categoryData.rows[0].icon);  // âœ… æ­£ç¡®è·å–
```

---

**é—®é¢˜3**: åœ¨åˆ—è¡¨é¡µé€ä¸ªæŸ¥è¯¢å…³è”æ•°æ® (N+1 é—®é¢˜)

**é”™è¯¯ç¤ºä¾‹**:
```javascript
// âŒ æ€§èƒ½ç¾éš¾:100ä¸ªäº§å“ = 1 + 100 = 101æ¬¡è¯·æ±‚
const products = await getProductList();  // 1æ¬¡è¯·æ±‚

for (const product of products) {
  const categoryId = product.category[0].sid;
  const category = await getCategoryById(categoryId);  // 100æ¬¡è¯·æ±‚!
  console.log(category.name);
}
```

**æ­£ç¡®åšæ³•**: æ‰¹é‡æŸ¥è¯¢ (å‚è§ Section 6.5.4)
```javascript
// âœ… æ€§èƒ½ä¼˜åŒ–:100ä¸ªäº§å“ = 1 + 1 = 2æ¬¡è¯·æ±‚
const products = await getProductList();  // 1æ¬¡è¯·æ±‚

// æ”¶é›†æ‰€æœ‰åˆ†ç±»ID
const categoryIds = new Set();
products.forEach(p => {
  if (p.category && p.category.length > 0) {
    categoryIds.add(p.category[0].sid);
  }
});

// æ‰¹é‡æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»
const categories = await getRows('category-worksheet-id', {
  filter: {
    type: 'condition',
    field: 'rowid',
    operator: 'in',
    value: Array.from(categoryIds)
  }
});  // 1æ¬¡è¯·æ±‚

// å»ºç«‹æ˜ å°„
const categoryMap = {};
categories.rows.forEach(cat => {
  categoryMap[cat.rowid] = cat;
});

// O(1) æŸ¥æ‰¾
products.forEach(p => {
  const category = categoryMap[p.category[0].sid];
  console.log(category.name, category.icon);
});
```

---

### 7.4 é™„ä»¶å­—æ®µé™·é˜±

**é—®é¢˜**: é™„ä»¶ä¸Šä¼ åç«‹å³è¯»å–è¿”å›ç©ºæ•°ç»„

**åŸå› **: é™„ä»¶ä¸Šä¼ æ˜¯å¼‚æ­¥å¤„ç†,éœ€è¦5-10ç§’

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// ä¸Šä¼ é™„ä»¶
await updateRecord({
  fields: [{
    id: "attachments",
    type: "0",
    value: [{name: "file.pdf", url: "https://..."}]
  }]
});

// ç­‰å¾…5ç§’
await sleep(5000);

// å†è¯»å–è®°å½•
const record = await getRecord(rowId);
console.log(record.attachments);  // ç°åœ¨æœ‰æ•°æ®äº†
```

**å»ºè®®**: ä½¿ç”¨æ˜é“äº‘å†…éƒ¨URL,å¤–éƒ¨URLå¯èƒ½æœ‰è·¨åŸŸé™åˆ¶

---

### 7.5 æ—¥æœŸå­—æ®µé™·é˜±

**é—®é¢˜**: æ—¥æœŸå†™å…¥æ—¶å¸¦æ—¶é—´,è¯»å–æ—¶åªè¿”å›æ—¥æœŸ

**åŸå› **: Dateå­—æ®µçš„subTypeå†³å®šè¿”å›ç²¾åº¦

**ç¤ºä¾‹**:
```json
// åˆ›å»ºå­—æ®µ
{
  "type": "Date",
  "subType": "3"  // å¹´æœˆæ—¥
}

// å†™å…¥
{
  "value": "2025-01-11 14:30:00"
}

// è¯»å–è¿”å›
{
  "date_field": "2025-01-11"  // æ—¶é—´è¢«æˆªæ–­
}
```

**è§£å†³æ–¹æ¡ˆ**: å¦‚éœ€ä¿ç•™æ—¶é—´,ä½¿ç”¨ `subType: "6"` (å¹´æœˆæ—¥æ—¶åˆ†ç§’)

---

### 7.6 FilteråµŒå¥—é™·é˜±

**é—®é¢˜**: è¿‡åº¦åµŒå¥—å¯¼è‡´æŸ¥è¯¢å¤±è´¥

**é”™è¯¯ç¤ºä¾‹**:
```json
{
  "type": "group",
  "children": [
    {
      "type": "group",
      "children": [
        {
          "type": "group",  // âŒ ç¬¬ä¸‰å±‚åµŒå¥—
          "children": [...]
        }
      ]
    }
  ]
}
```

**é™åˆ¶**: æœ€å¤šä¸¤å±‚åµŒå¥— (group â†’ group â†’ condition)

**è§£å†³æ–¹æ¡ˆ**: é‡æ–°è®¾è®¡æŸ¥è¯¢é€»è¾‘,åˆå¹¶æ¡ä»¶

---

### 7.7 æˆå‘˜å­—æ®µé™·é˜±

**é—®é¢˜**: ä½¿ç”¨å§“åæŸ¥è¯¢æˆå‘˜å­—æ®µå¤±è´¥

**é”™è¯¯ç¤ºä¾‹**:
```json
{
  "field": "owner",
  "operator": "eq",
  "value": ["å¼ ä¸‰"]  // âŒ å§“åæ— æ•ˆ
}
```

**æ­£ç¡®åšæ³•**:
```bash
# Step 1: é€šè¿‡å§“åæŸ¥æ‰¾ç”¨æˆ·ID
POST /v3/users/lookup
{"name": "å¼ ä¸‰"}

# è¿”å›: {"accountId": "user-123"}

# Step 2: ä½¿ç”¨ç”¨æˆ·IDç­›é€‰
{
  "field": "owner",
  "operator": "eq",
  "value": ["user-123"]  // âœ… ç”¨æˆ·ID
}
```

---

### 7.8 æ‰¹é‡æ“ä½œé™·é˜±

**é—®é¢˜**: æ‰¹é‡æ›´æ–°æ—¶è¯¯è¦†ç›–ä¸åŒè®°å½•

**åœºæ™¯**: æƒ³ç»™ä¸åŒå®¢æˆ·è®¾ç½®ä¸åŒè¯„çº§

**é”™è¯¯åšæ³•**:
```json
{
  "rowIds": ["id1", "id2", "id3"],
  "fields": [
    {"id": "rating", "value": "5"}  // âŒ æ‰€æœ‰è®°å½•éƒ½å˜æˆ5æ˜Ÿ
  ]
}
```

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨å•æ¡æ›´æ–°æˆ–æ‰¹é‡åˆ›å»ºæ—¶åˆ†åˆ«æŒ‡å®š

---

## å…«ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 8.1 æŸ¥è¯¢ä¼˜åŒ–

1. **åˆç†ä½¿ç”¨åˆ†é¡µ**: pageSizeä¸è¦è¶…è¿‡1000
2. **æŒ‡å®šè¿”å›å­—æ®µ**: ä½¿ç”¨fieldså‚æ•°,åªè¿”å›éœ€è¦çš„å­—æ®µ
3. **ä½¿ç”¨å­—æ®µID**: æ¯”åˆ«åæŸ¥è¯¢æ€§èƒ½æ›´å¥½
4. **é¿å…è¿‡åº¦åµŒå¥—**: FilteråµŒå¥—æ§åˆ¶åœ¨2å±‚ä»¥å†…
5. **å–„ç”¨è§†å›¾**: å¤æ‚ç­›é€‰å¯å…ˆåˆ›å»ºè§†å›¾,å†æŸ¥è¯¢è§†å›¾

---

### 8.2 æ‰¹é‡æ“ä½œä¼˜åŒ–

1. **æ‰¹é‡åˆ›å»º**: ä¸€æ¬¡æœ€å¤š100æ¡
2. **æ‰¹é‡æ›´æ–°**: ä¸€æ¬¡æœ€å¤š100æ¡
3. **å¼‚æ­¥å¤„ç†**: å¤§æ‰¹é‡æ“ä½œä½¿ç”¨é˜Ÿåˆ—å¼‚æ­¥å¤„ç†

---

### 8.3 å…³è”å­—æ®µä¼˜åŒ–

1. **å‡å°‘åµŒå¥—æŸ¥è¯¢**: ä½¿ç”¨ get_record_relations API ä¸€æ¬¡è·å–
2. **ç¼“å­˜å…³è”æ•°æ®**: é¢‘ç¹è®¿é—®çš„å…³è”æ•°æ®å¯ç¼“å­˜
3. **æ§åˆ¶showFields**: åªæ˜¾ç¤ºå¿…è¦å­—æ®µ,å‡å°‘æ•°æ®é‡

---

## ä¹ã€æœ€ä½³å®è·µæ€»ç»“

### 9.1 åˆå§‹åŒ–é˜¶æ®µ

**å¿…åšäº‹é¡¹**:
1. æŸ¥è¯¢æ‰€æœ‰å·¥ä½œè¡¨ç»“æ„
2. ç¼“å­˜æ‰€æœ‰é€‰é¡¹å­—æ®µçš„key-valueæ˜ å°„
3. ç¼“å­˜å·¥ä½œè¡¨IDå’Œå­—æ®µID
4. å»ºç«‹ç”¨æˆ·å§“åâ†’IDæ˜ å°„

**ç¤ºä¾‹ä»£ç é€»è¾‘**:
```javascript
// 1. è·å–å·¥ä½œè¡¨ç»“æ„
const structure = await getWorksheetStructure(worksheetId);

// 2. æå–é€‰é¡¹å­—æ®µæ˜ å°„
const optionMaps = {};
structure.fields.forEach(field => {
  if (field.type === 'SingleSelect' || field.type === 'MultipleSelect') {
    optionMaps[field.id] = {};
    field.options.forEach(opt => {
      optionMaps[field.id][opt.value] = opt.key;  // value â†’ key
    });
  }
});

// 3. ä½¿ç”¨æ—¶æŸ¥æ‰¾key
const customerTypeKey = optionMaps['customer_type']['æˆäº¤å®¢æˆ·'];
```

---

### 9.2 æŸ¥è¯¢é˜¶æ®µ

**å»ºè®®**:
1. ä¼˜å…ˆä½¿ç”¨å­—æ®µIDè€Œä¸æ˜¯åˆ«å
2. é€‰é¡¹å­—æ®µå¿…é¡»ç”¨key,æå‰è½¬æ¢
3. æ•°å€¼å­—æ®µvalueç”¨å­—ç¬¦ä¸²
4. å…³è”å­—æ®µç”¨belongstoæ“ä½œç¬¦
5. åˆç†è®¾ç½®pageSize(å»ºè®®100-500)

---

### 9.3 å†™å…¥é˜¶æ®µ

**æ£€æŸ¥æ¸…å•**:
- [ ] é€‰é¡¹å­—æ®µvalueæ˜¯æ•°ç»„æ ¼å¼
- [ ] é€‰é¡¹å­—æ®µä¼ çš„æ˜¯keyä¸æ˜¯value
- [ ] æ•°å€¼å­—æ®µä¼ æ•°å­—ç±»å‹
- [ ] å…³è”å­—æ®µä¼ çš„æ˜¯rowid
- [ ] æˆå‘˜å­—æ®µä¼ çš„æ˜¯accountId
- [ ] é™„ä»¶å­—æ®µè®¾ç½®äº†typeå‚æ•°

---

### 9.4 é”™è¯¯å¤„ç†

**å¸¸è§é”™è¯¯ç **:
- `error_code: 1` - æˆåŠŸ
- `error_code: -1` - å¤±è´¥,æŸ¥çœ‹error_msg
- `error_code: 4` - æƒé™ä¸è¶³
- `error_code: 10` - å‚æ•°é”™è¯¯

**å»ºè®®**: æ‰€æœ‰APIè°ƒç”¨éƒ½è¦æ£€æŸ¥error_codeå’Œsuccess

---

## åã€å®Œæ•´ç¤ºä¾‹:æ„å»ºCRMåº”ç”¨

### 10.1 åˆ›å»ºå·¥ä½œè¡¨

```bash
# 1. åˆ›å»ºå®¢æˆ·è¡¨
POST /v3/app/worksheets
{
  "name": "å®¢æˆ·ä¿¡æ¯è¡¨",
  "fields": [
    {"name": "å®¢æˆ·åç§°", "type": "Text", "isTitle": true},
    {"name": "å®¢æˆ·ç±»å‹", "type": "SingleSelect", "options": [...]},
    {"name": "å¹´åº¦é¢„ç®—", "type": "Number", "precision": 2}
  ]
}

# 2. åˆ›å»ºæœºä¼šè¡¨(å…³è”å®¢æˆ·)
POST /v3/app/worksheets
{
  "name": "é”€å”®æœºä¼šè¡¨",
  "fields": [
    {"name": "æœºä¼šåç§°", "type": "Text", "isTitle": true},
    {
      "name": "å…³è”å®¢æˆ·",
      "type": "Relation",
      "subType": "1",
      "dataSource": "{customer_table_id}"
    }
  ]
}
```

---

### 10.2 åˆ›å»ºæ•°æ®

```bash
# 1. åˆ›å»ºå®¢æˆ·
POST /v3/app/worksheets/{customer_table_id}/rows
{
  "fields": [
    {"id": "customer_name", "value": "æ˜é“äº‘ç§‘æŠ€"},
    {"id": "customer_type", "value": ["{æˆäº¤å®¢æˆ·key}"]},
    {"id": "annual_budget", "value": 1000000}
  ]
}

# 2. åˆ›å»ºæœºä¼š(å…³è”å®¢æˆ·)
POST /v3/app/worksheets/{opportunity_table_id}/rows
{
  "fields": [
    {"id": "opportunity_name", "value": "å¹´åº¦ç»­è´¹"},
    {"id": "related_customer", "value": ["{customer_rowid}"]}
  ]
}
```

---

### 10.3 æŸ¥è¯¢åˆ†æ

```bash
# 1. æŸ¥è¯¢é‡ç‚¹å®¢æˆ·
POST /v3/app/worksheets/{customer_table_id}/rows/list
{
  "filter": {
    "type": "group",
    "logic": "AND",
    "children": [
      {"type": "condition", "field": "customer_type", "operator": "eq", "value": ["{æˆäº¤key}"]},
      {"type": "condition", "field": "annual_budget", "operator": "gte", "value": ["500000"]}
    ]
  }
}

# 2. æŒ‰è¡Œä¸šç»Ÿè®¡å®¢æˆ·
POST /v3/app/worksheets/{customer_table_id}/rows/pivot
{
  "rows": [{"field": "industry"}],
  "values": [
    {"field": "rowid", "aggregation": "COUNT"},
    {"field": "annual_budget", "aggregation": "SUM"}
  ]
}
```

---

## é™„å½•A:å­—æ®µç±»å‹é€ŸæŸ¥è¡¨

| ç±»å‹ | typeå€¼ | å†™å…¥æ ¼å¼ | è¯»å–æ ¼å¼ | å…³é”®å‚æ•° |
|-----|--------|---------|---------|---------|
| æ–‡æœ¬ | Text | å­—ç¬¦ä¸² | å­—ç¬¦ä¸² | - |
| æ•°å€¼ | Number | æ•°å­— | å­—ç¬¦ä¸² | precision |
| å•é€‰ | SingleSelect | æ•°ç»„[key] | å¯¹è±¡æ•°ç»„ | options |
| å¤šé€‰ | MultipleSelect | æ•°ç»„[key...] | å¯¹è±¡æ•°ç»„ | options |
| æ—¥æœŸ | Date | å­—ç¬¦ä¸² | å­—ç¬¦ä¸² | subType |
| æ—¶é—´ | Time | å­—ç¬¦ä¸² | å­—ç¬¦ä¸² | subType |
| æˆå‘˜ | Collaborator | æ•°ç»„[id] | å¯¹è±¡/æ•°ç»„ | subType |
| å…³è” | Relation | æ•°ç»„[rowid] | å¯¹è±¡/æ•°ç»„ | dataSource, subType |
| é™„ä»¶ | Attachment | å¯¹è±¡æ•°ç»„ | å¯¹è±¡æ•°ç»„ | - |
| ç­‰çº§ | Rating | å­—ç¬¦ä¸² | å­—ç¬¦ä¸² | max |

---

## é™„å½•B:æ“ä½œç¬¦é€ŸæŸ¥è¡¨

| æ“ä½œç¬¦ | é€‚ç”¨å­—æ®µ | valueæ ¼å¼ | è¯´æ˜ |
|-------|---------|----------|------|
| eq | æ‰€æœ‰ | ["å€¼"] | ç­‰äº |
| ne | æ‰€æœ‰ | ["å€¼"] | ä¸ç­‰äº |
| contains | Text, Multi | ["å€¼"] | åŒ…å« |
| startswith | Text | ["å€¼"] | å¼€å¤´æ˜¯ |
| gt/gte/lt/lte | Number, Date | ["å€¼"] | æ¯”è¾ƒ |
| between | Number, Date | ["æœ€å°", "æœ€å¤§"] | èŒƒå›´ |
| isempty | æ‰€æœ‰ | æ—  | ä¸ºç©º |
| belongsto | Relation | ["id"...] | å±äº |

---

## é™„å½•C:é”™è¯¯æ’æŸ¥æ¸…å•

**ç­›é€‰æ— ç»“æœ**:
- [ ] é€‰é¡¹å­—æ®µæ˜¯å¦ç”¨äº†keyè€Œä¸æ˜¯value?
- [ ] æ•°å€¼å­—æ®µvalueæ˜¯å¦ç”¨äº†å­—ç¬¦ä¸²?
- [ ] å…³è”å­—æ®µæ˜¯å¦ç”¨äº†belongsto?
- [ ] FilteråµŒå¥—æ˜¯å¦è¶…è¿‡2å±‚?
- [ ] å­—æ®µIDæ˜¯å¦æ­£ç¡®?

**åˆ›å»º/æ›´æ–°å¤±è´¥**:
- [ ] å¿…å¡«å­—æ®µæ˜¯å¦éƒ½æä¾›äº†?
- [ ] å…³è”å­—æ®µçš„dataSourceæ˜¯å¦å­˜åœ¨?
- [ ] é€‰é¡¹å­—æ®µçš„keyæ˜¯å¦æœ‰æ•ˆ?
- [ ] æˆå‘˜å­—æ®µçš„accountIdæ˜¯å¦æœ‰æ•ˆ?
- [ ] æ•°å€¼å­—æ®µæ˜¯å¦è¶…å‡ºèŒƒå›´?

**æ•°æ®å¼‚å¸¸**:
- [ ] é™„ä»¶æ˜¯å¦ç­‰å¾…äº†5-10ç§’?
- [ ] æ—¥æœŸç²¾åº¦subTypeæ˜¯å¦æ­£ç¡®?
- [ ] å…³è”è®°å½•æ˜¯å¦å·²åˆ é™¤?

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**ç”Ÿæˆæ—¶é—´**: 2026-01-11
**åŸºäº**: HAP API V3
**æµ‹è¯•éªŒè¯**: å®Œæ•´CRMåº”ç”¨åœºæ™¯æµ‹è¯•
