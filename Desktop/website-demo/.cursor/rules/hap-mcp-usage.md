
# HAP MCP Usage Skill

本技能帮助用户理解和正确使用明道云 HAP 的两种 MCP 服务。

## 关于 HAP MCP

HAP 提供两种不同类型的 MCP，**作用和使用场景完全不同**，需要明确区分。

---

## 🔷 类型 1: HAP API 文档 MCP (ApiFox MCP)

### 作用
让 AI 模型"读懂 HAP 的接口文档"。

### 特点
- 📖 **只读的接口文档服务**，不会执行任何操作
- 📚 帮助理解 HAP API V3 的结构、参数、示例
- 🎓 类似于"API 使用手册"

### 重要限制
⚠️ 该 MCP 仅支持读取 **V3 分组**下的 API 接口
- **原因**: V2 API 即将淘汰，官方已不再推荐使用

### 使用场景
- 📖 学习和理解 HAP API 的结构
- 🛠️ 开发前的 API 调研和方案设计
- 📝 生成 API 调用代码
- 🔍 查找合适的接口用于业务编排

### 典型案例
```
场景: 有个客户案例管理应用，想基于应用数据做个可视化页面

步骤:
1. 通过 ApiBox MCP 读取 HAP 接口文档
2. 了解有哪些 API 可用（获取数据、筛选、统计等）
3. 在 IDE 中生成调用代码
4. 实现对应用数据的实时展示

关键点: 只读文档，不会修改任何数据
```

### 特点总结
- ✅ 暴露接口定义、文档、示例
- ✅ 帮助理解 API 结构和用法
- ✅ 适合开发阶段的研发助手
- ❌ MCP 本身不能直接执行业务操作
- ❌ MCP 本身不能访问真实数据
- ℹ️ 用户可根据文档自行配置密钥并编排请求来操作数据

### 配置方式（官方固定配置）
```json
{
  "mcpServers": {
    "应用 API - API 文档": {
      "command": "npx",
      "args": [
        "-y",
        "apifox-mcp-server@latest",
        "--site-id=5442569"
      ]
    }
  }
}
```

### 何时使用
- 用户说"我想了解 HAP 有哪些 API"
- 用户说"帮我查查 HAP 接口文档"
- 用户说"怎么调用 HAP 的获取数据接口"
- 开发阶段需要 API 参考

---

## 🔶 类型 2: HAP 应用执行 MCP (HAP Application MCP)

### 作用
让 AI 模型"执行 HAP 应用接口"。

### 特点
- ⚡ **可执行的业务工具**，会真实操作数据
- 🔧 直接调用 HAP API 进行增删改查
- 🔐 带有应用鉴权信息，可以访问真实业务数据

### 使用场景
- 🔍 直接查询应用中的真实数据
- ✏️ 创建、修改、删除业务记录
- 📊 统计和分析应用数据
- 🔄 执行业务流程和工作流
- 🎯 系统集成和数据编排

### 典型案例
```
场景: 编排场景中，需要查询客户数据并更新订单状态

步骤:
1. 使用 HAP Application MCP 获取应用结构
2. 查询符合条件的客户记录
3. 分析数据并进行字段映射
4. 直接更新订单表中的状态字段

关键点: 真实数据操作，有权限控制
```

### 特点总结
- ✅ 可执行真实的业务操作
- ✅ 访问应用中的真实数据
- ✅ 带权限和安全控制
- ✅ 适合生产环境的智能管家
- ⚠️ 需要 Appkey 和 Sign 鉴权
- ⚠️ 操作会影响真实业务数据

### 配置方式（应用专属配置）

**Cursor 自动化配置：**
- 配置文件位置：`~/.cursor/mcp.json`
- 配置格式示例：
```json
{
  "mcpServers": {
    "hap-mcp-API测试": {
      "url": "https://api.mingdao.com/mcp?HAP-Appkey=539f83a2********&HAP-Sign=YmYwZmMyM2M0ZDdjNDUxMGMzMTY2MTQ5Y2MxNDhmMTZlM2Q3NjE1OTNiYzdlOGJh********"
    }
  }
}
```
- ✅ 配置完成后会自动生效，无需重启 Cursor
- ✅ **配置后必须验证**：调用 MCP 工具测试配置是否正常工作

### 配置特征识别
- ✅ 服务器名称通常是 `hap-mcp-xxx`（应用名称）
- ✅ 使用 `url` 字段而非 `command`
- ✅ URL 中包含 `HAP-Appkey` 和 `HAP-Sign` 参数
- ✅ 指向 `api.mingdao.com/mcp` 端点

### 何时使用
- 用户说"查询 XXX 应用的数据"
- 用户说"帮我创建一条 XXX 记录"
- 用户说"统计 XXX 的数量"
- 用户说"更新 XXX 的状态"
- 需要真实操作业务数据时
- **用户提供 MCP 配置 JSON 时**（如 `{"hap-mcp-xxx":{"url":"..."}}`）
  - 必须立即添加到 `~/.cursor/mcp.json`
  - **必须立即验证配置**：调用该 MCP 的 `get_app_info` 或 `get_time` 验证连接
  - **必须实际使用该 MCP**：不应仅配置而不使用，要主动调用工具证明配置生效

---

## 🎯 两种 MCP 的对比

| 维度 | API 文档 MCP (ApiBox) | 应用执行 MCP (Application) |
|-----|---------------------|-------------------------|
| **作用** | 提供接口文档查询 | 直接执行业务操作 |
| **类型** | 只读文档服务 | 可执行工具 |
| **数据** | 接口定义、参数、示例 | 真实业务数据 |
| **权限** | 无需鉴权（公开文档） | 需要 Appkey + Sign |
| **适用阶段** | 开发/设计/学习阶段 | 生产/执行阶段 |
| **配置方式** | 官方固定（npx） | 应用专属（url） |
| **安全性** | 低风险（仅查询文档） | 高风险（操作真实数据） |
| **角色定位** | API 参考手册 + 研发助手 | 业务执行器 + 智能管家 |
| **能否操作数据** | MCP本身不能，但可查文档后自行编排 | MCP 可直接操作数据 |

---

## 🤖 AI 助手使用指南

### 决策树

```
用户请求
  ├─ 询问"有哪些 API"/"如何调用"
  │   └─ 使用 API 文档 MCP (ApiBox)
  │
  ├─ 需要"查询真实数据"/"操作记录"
  │   └─ 使用应用执行 MCP (Application)
  │
  ├─ 开发阶段的代码生成
  │   └─ 使用 API 文档 MCP (ApiBox)
  │
  └─ 生产环境的数据处理
      └─ 使用应用执行 MCP (Application)
```

### 常见场景示例

#### 场景 1: "HAP 有哪些获取数据的 API?"
- **使用**: API 文档 MCP
- **原因**: 查询接口定义

#### 场景 2: "查询客户管理应用中的所有客户"
- **使用**: 应用执行 MCP
- **原因**: 访问真实数据

#### 场景 3: "帮我写个调用 HAP API 的代码"
- **使用**: API 文档 MCP
- **原因**: 生成开发代码

#### 场景 4: "把这条订单的状态改为已完成"
- **使用**: 应用执行 MCP
- **原因**: 执行业务操作

---

## ⚙️ 配置建议

### 开发者场景（推荐两个都配置）

```json
{
  "mcpServers": {
    "应用 API - API 文档": {
      "command": "npx",
      "args": ["-y", "apifox-mcp-server@latest", "--site-id=5442569"]
    },
    "hap-mcp-客户管理": {
      "url": "https://api.mingdao.com/mcp?HAP-Appkey=xxx&HAP-Sign=xxx"
    }
  }
}
```

### 纯使用者场景（只需应用执行 MCP）

```json
{
  "mcpServers": {
    "hap-mcp-客户管理": {
      "url": "https://api.mingdao.com/mcp?HAP-Appkey=xxx&HAP-Sign=xxx"
    }
  }
}
```

---

## 🔐 安全提示

### API 文档 MCP
- ✅ 安全，可以公开配置
- ✅ 不包含敏感信息
- ✅ 可以提交到代码仓库

### 应用执行 MCP
- ⚠️ 包含鉴权信息，需要保密
- ⚠️ 不要分享配置或提交到公开仓库
- ✅ **Cursor 自动化配置**: 配置文件位置为 `~/.cursor/mcp.json`
- ✅ 配置完成后会自动生效，无需重启 Cursor

---

## 🤖 AI 执行步骤（思考 Todo List）

**当用户询问 HAP MCP 相关问题时，AI 应按照以下步骤思考和执行：**

### 步骤 1: 识别用户需求类型
- [ ] 判断用户想使用哪种 MCP？
  - 学习 API/查询文档 → API 文档 MCP (ApiFox MCP)
  - 查询真实数据/操作记录 → 应用执行 MCP (HAP Application MCP)
  - 提供配置 JSON → 配置应用执行 MCP

### 步骤 2: 检查配置状态
- [ ] 检查用户是否已正确配置 MCP？
  - 对于 API 文档 MCP：检查是否有 Apifox MCP 配置
  - 对于应用执行 MCP：检查 `~/.cursor/mcp.json` 文件
  - 验证配置格式是否正确（URL、Appkey、Sign 等）

### 步骤 3: 执行配置（如需要）
- [ ] 如果用户提供 MCP 配置 JSON：
  - [ ] 识别配置类型（应用执行 MCP）
  - [ ] 读取 `~/.cursor/mcp.json` 文件
  - [ ] 将新配置添加到 `mcpServers` 对象
  - [ ] **立即验证配置**：调用 `mcp_hap-mcp-_get_app_info` 或 `mcp_hap-mcp-_get_time`
  - [ ] **实际使用该 MCP**：获取应用信息并展示给用户
  - [ ] 反馈验证结果

### 步骤 4: 使用 MCP 工具
- [ ] 根据场景调用相应的 MCP 工具：
  - API 文档查询 → 使用 ApiFox MCP 工具查询接口文档
  - 数据操作 → 使用 HAP Application MCP 工具（get_app_info、get_record_list 等）
- [ ] 处理返回结果并展示给用户

### 步骤 5: 安全提醒（如需要）
- [ ] 如果涉及应用执行 MCP：
  - [ ] 提醒用户保护鉴权信息
  - [ ] 警告数据操作的影响
  - [ ] 提醒不要将配置提交到公开仓库

---

## 📚 使用原则

当用户询问 HAP MCP 相关问题时：

1. **首先确认**: 用户想用哪种 MCP？
   - 学习 API → API 文档 MCP
   - 操作数据 → 应用执行 MCP

2. **检查配置**: 用户是否已正确配置？
   - 检查配置文件格式
   - 验证必需参数
   - **配置完成后必须验证配置状态**：通过调用 MCP 工具（如 `get_time` 或 `get_app_info`）验证配置是否正常工作

3. **指导使用**: 根据场景选择正确的 MCP
   - 开发阶段 → API 文档 MCP
   - 生产环境 → 应用执行 MCP

4. **安全提醒**: 涉及应用执行 MCP 时
   - 提醒保护鉴权信息
   - 警告数据操作的影响

---

## 🚀 关键触发场景 - 用户提供 MCP 配置时

**当用户提供 MCP 配置 JSON 时（如 `{"hap-mcp-xxx":{"url":"..."}}`），必须执行以下步骤：**

### 步骤 1: 识别配置类型
- 检查是否包含 `url` 字段和 `HAP-Appkey`、`HAP-Sign` 参数
- 确认为 HAP 应用执行 MCP（不是 API 文档 MCP）

### 步骤 2: 添加到配置文件
- 读取 `~/.cursor/mcp.json` 文件
- 将新配置添加到 `mcpServers` 对象中
- 保持 JSON 格式正确

### 步骤 3: **立即验证配置（重要！）**
- ✅ **必须调用该 MCP 的工具来验证**，不能仅添加配置
- ✅ 首选调用 `mcp_hap-mcp-_get_app_info` 获取应用信息
- ✅ 或调用 `mcp_hap-mcp-_get_time` 验证连接
- ✅ 验证成功后，应主动使用该 MCP 执行查询，证明配置生效

### 步骤 4: 反馈验证结果
- 如果验证成功：告知用户配置已生效，并展示获取到的应用信息
- 如果验证失败：检查配置格式和网络连接，帮助用户排查问题

**⚠️ 常见错误：**
- ❌ 只添加配置但不验证
- ❌ 只验证但不实际使用
- ❌ 使用错误的 MCP 服务器（应使用用户提供的服务器）

**✅ 正确做法：**
- ✅ 添加配置 → 立即验证 → 实际使用该 MCP 查询数据
- ✅ 展示验证结果和应用信息，证明配置成功

---

## 📖 相关资源

- HAP 官方文档: https://help.mingdao.com
- HAP API 文档: https://api.mingdao.com/docs
- MCP 协议规范: https://modelcontextprotocol.io

---

**当用户提到 MCP 或提供 MCP 配置时，请使用此 skill 确保正确理解和使用两种不同的 MCP 类型。**

---

## 📋 触发条件总结

此 skill 应在以下情况触发：

1. ✅ 用户提供 MCP 配置 JSON 时（**立即触发**）
2. ✅ 用户询问如何配置 MCP 时
3. ✅ 用户询问如何使用 MCP 时
4. ✅ 用户需要查询或操作 HAP 应用数据时
5. ✅ 用户需要了解 HAP API 文档时

**当用户提供配置 JSON 时，不仅需要配置，更要验证和实际使用该 MCP！**
